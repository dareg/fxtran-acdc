SUBROUTINE APL_ARPEGE_DEEP_CONVECTION (YDMF_PHYS_BASE_STATE, YDGEOMETRY,&
& YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, YDCPG_DYN0, YDMF_PHYS_SURF, YDVARS,&
& YDMODEL, PFPCOR, PQV, PTENHA, PTENQVA, PTENT, PRDG_CVGQ, PRDG_CVGT)
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE CPG_TYPE_MOD,ONLY:CPG_DYN_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE YOMCFU,ONLY:TCFU
USE TYPE_MODEL,ONLY:MODEL

IMPLICIT NONE


TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (CPG_DYN_TYPE), INTENT (IN)::YDCPG_DYN0
TYPE (MF_PHYS_SURF_TYPE), INTENT (INOUT)::YDMF_PHYS_SURF
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (MODEL), INTENT (IN)::YDMODEL
REAL (KIND=JPRB), INTENT (OUT)::PFPCOR (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTENHA (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTENQVA (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTENT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PRDG_CVGQ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PRDG_CVGT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)

#include "apl_arpege_deep_convection_init.intfb.h"
#include "apl_arpege_deep_convection_culight.intfb.h"
#include "apl_arpege_deep_convection_copy.intfb.h"
#include "apl_arpege_deep_convection_cucalln_mf.intfb.h"
#include "apl_arpege_deep_convection_zero.intfb.h"
#include "apl_arpege_deep_convection_acuptq.intfb.h"




INTEGER (KIND=JPIM)::ICBOT (YDCPG_OPTS%KLON)

INTEGER (KIND=JPIM)::ICTOP (YDCPG_OPTS%KLON)

INTEGER (KIND=JPIM)::ISPPN2D


LOGICAL::LLCUM (YDCPG_OPTS%KLON)

LOGICAL::LLDSLPHY
LOGICAL::LLLAND (YDCPG_OPTS%KLON)


LOGICAL::LLSHCV (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZACPR (YDCPG_OPTS%KLON)



REAL (KIND=JPRB)::ZCUCONVCA (YDCPG_OPTS%KLON)

REAL (KIND=JPRB)::ZDXTDK (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZFCQLF (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZFCQLI (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)



REAL (KIND=JPRB)::ZGEOM1 (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZGEOMH (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)


REAL (KIND=JPRB)::ZLCRIT_AER (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)

REAL (KIND=JPRB)::ZLISUM (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)

REAL (KIND=JPRB)::ZLU (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)




REAL (KIND=JPRB)::ZMFU (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)




REAL (KIND=JPRB)::ZSNDE (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, 2)

REAL (KIND=JPRB)::ZTENT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTENQ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTENU (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTENV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTENTA (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTENQA (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZVDIFTS
REAL (KIND=JPRB)::ZVERVEL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)





REAL (KIND=JPRB)::ZTENDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTENDQ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)




LOGICAL::LLPTQ
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DEEP_CONVECTION', 0, ZHOOK_HANDLE)

CALL APL_ARPEGE_DEEP_CONVECTION_INIT (YDVARS, YDCPG_DYN0, YDCPG_OPTS, YDMF_PHYS_SURF&
&, YDMF_PHYS_BASE_STATE, YDGEOMETRY, YDCPG_BNDS, ZDXTDK, LLLAND, ZVERVEL, ZFCQLF&
&, ZGEOM1, ZGEOMH, ZLISUM, ZACPR, ZLCRIT_AER, ZCUCONVCA, ZFCQLI, LLSHCV)
LLPTQ=.FALSE.
CALL APL_ARPEGE_DEEP_CONVECTION_ACUPTQ (LLPTQ, YDMF_PHYS_BASE_STATE&
&, YDCPG_OPTS, YDMF_PHYS, YDMODEL, YDCPG_BNDS, PTENHA, PTENQVA)
CALL APL_ARPEGE_DEEP_CONVECTION_ZERO (YDCPG_OPTS, YDMF_PHYS_BASE_STATE, YDCPG_BNDS, PTENHA&
&, ZTENV, PRDG_CVGT, ZTENT, ZTENQ, ZTENDQ, ZTENDT, ZTENU, PRDG_CVGQ, PTENQVA)
LLDSLPHY=.TRUE.
ZVDIFTS=0._JPRB
ISPPN2D=0
CALL APL_ARPEGE_DEEP_CONVECTION_CUCALLN_MF (LLDSLPHY, ISPPN2D, YDMODEL, YDVARS, YDCPG_OPTS&
&, YDMF_PHYS, YDMF_PHYS_BASE_STATE, ZVDIFTS, YDCPG_BNDS, ZDXTDK, ZGEOMH, ZLISUM, ZFCQLI&
&, ZSNDE, ZVERVEL, ZTENV, ZTENT, ZMFU, ZLU, LLLAND, ZGEOM1, ZFCQLF, ICBOT, PQV, ZACPR,&
& LLSHCV, ICTOP, ZTENQ, ZTENDT, ZTENDQ, ZLCRIT_AER, ZCUCONVCA, LLCUM, ZTENU)
CALL APL_ARPEGE_DEEP_CONVECTION_COPY (YDCPG_OPTS, YDMF_PHYS, YDCPG_BNDS, ZSNDE, PFPCOR)

IF (YDCPG_OPTS%LFLASH) THEN
  CALL APL_ARPEGE_DEEP_CONVECTION_CULIGHT (YDVARS, YDCPG_OPTS, YDMF_PHYS, YDMF_PHYS_BASE_STATE&
  &, YDMODEL, YDCPG_BNDS, LLLAND, ICBOT, ICTOP, ZMFU, ZLU, LLCUM)
ENDIF


IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DEEP_CONVECTION', 1, ZHOOK_HANDLE)
ENDSUBROUTINE APL_ARPEGE_DEEP_CONVECTION
