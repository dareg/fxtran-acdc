SUBROUTINE LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL (YDGEOMETRY, YDCPG_BNDS, YDCPG_OPTS, YDCPG_SL1)
USE PARKIND1,ONLY:JPIM, JPRB
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE CPG_SL1_TYPE_MOD,ONLY:CPG_SL1B_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_OPTS_TYPE, CPG_BNDS_TYPE
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE YOMPARALLELMETHOD
USE STACK_MOD
USE ACPY_MOD
#include "stack.h"

IMPLICIT NONE


TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_SL1B_TYPE), INTENT (INOUT)::YDCPG_SL1
INTEGER (KIND=JPIM)::JGFL
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER (KIND=JPIM) :: JROF
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(STACK) :: YLSTACK
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_GFL_P(:,:,:)
#include "abor1.intfb.h"
IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL', 0, ZHOOK_HANDLE)

CALL GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)

DO JGFL=1, SIZE (YDCPG_SL1%GFL)

  IF ((YDCPG_SL1%GFL (JGFL)%YCOMP%CSLINT/='LAITVSPCQM  ').AND.YDCPG_SL1%GFL (JGFL)%YCOMP%LADV) THEN
    IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0',0,ZHOOK_HANDLE_PARALLEL)

    IF (LPARALLELMETHOD ('OPENMP','LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
      &:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_SL1_GFL_P => GET_HOST_DATA_RDWR (YDCPG_SL1%GFL (JGFL)%F_P)
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
      &:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
      !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
          CALL YLCPG_BNDS%UPDATE (JBLK)
          
          Z_YDCPG_SL1_GFL_P  (:, 0, JBLK)=0.0_JPRB  
          Z_YDCPG_SL1_GFL_P  (:, YDGEOMETRY%YRDIMV%NFLEVG+1, JBLK)=0.0_JPRB  
      ENDDO

      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (LSYNCHOST ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0')) THEN
        IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
        &:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDCPG_SL1_GFL_P => GET_HOST_DATA_RDWR (YDCPG_SL1%GFL (JGFL)%F_P)
        IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
        &:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_SL1_GFL_P => NULL ()
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (LPARALLELMETHOD ('OPENMPSINGLECOLUMN','LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
      &:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_SL1_GFL_P => GET_HOST_DATA_RDWR (YDCPG_SL1%GFL (JGFL)%F_P)
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
      &:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      !$OMP PARALLEL DO PRIVATE (JBLK, JROF, YLCPG_BNDS, YLSTACK)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

          

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF
          YLSTACK%L8 = stack_l8 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U8 = stack_u8 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%L4 = stack_l4 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U4 = stack_u4 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
            
            Z_YDCPG_SL1_GFL_P  (JROF, 0, JBLK)=0.0_JPRB  
            Z_YDCPG_SL1_GFL_P  (JROF, YDGEOMETRY%YRDIMV%NFLEVG+1, JBLK)=0.0_JPRB  
        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (LSYNCHOST ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0')) THEN
        IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
        &:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDCPG_SL1_GFL_P => GET_HOST_DATA_RDWR (YDCPG_SL1%GFL (JGFL)%F_P)
        IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
        &:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_SL1_GFL_P => NULL ()
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (LPARALLELMETHOD ('OPENACCSINGLECOLUMN','LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
      &:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_SL1_GFL_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%GFL (JGFL)%F_P)
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
      &:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      
        !$ACC PARALLEL LOOP GANG &
        !$ACC&PRESENT (YDCPG_OPTS, YDGEOMETRY, YSTACK, Z_YDCPG_SL1_GFL_P) &
        !$ACC&PRIVATE (JBLK) &
        !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
        
        DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
          
        
        
        !$ACC LOOP VECTOR &
        !$ACC&PRIVATE (JROF, YLCPG_BNDS, YLSTACK) 

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF
          YLSTACK%L8 = stack_l8 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U8 = stack_u8 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%L4 = stack_l4 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U4 = stack_u4 (YSTACK, JBLK-YDCPG_OPTS%JBLKMIN+1, YDCPG_OPTS%KGPBLKS)
            
            Z_YDCPG_SL1_GFL_P  (JROF, 0, JBLK)=0.0_JPRB  
            Z_YDCPG_SL1_GFL_P  (JROF, YDGEOMETRY%YRDIMV%NFLEVG+1, JBLK)=0.0_JPRB  
        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (LSYNCHOST ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0')) THEN
        IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
        &:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDCPG_SL1_GFL_P => GET_HOST_DATA_RDWR (YDCPG_SL1%GFL (JGFL)%F_P)
        IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL&
        &:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_SL1_GFL_P => NULL ()
      IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSE
        CALL ABOR1 ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL: NOT METHOD WAS FOUND')
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL:0',1,ZHOOK_HANDLE_PARALLEL)
  ENDIF

ENDDO


CALL GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL', 1, ZHOOK_HANDLE)
ENDSUBROUTINE LAVABO_EXPL_LAITVSPCQM_PART1_PARALLEL
