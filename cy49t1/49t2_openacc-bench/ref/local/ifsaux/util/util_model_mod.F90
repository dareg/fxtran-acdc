MODULE UTIL_MODEL_MOD

USE TYPE_MODEL, ONLY : MODEL

INTERFACE SAVE
MODULE PROCEDURE SAVE_MODEL
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_MODEL
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_MODEL
END INTERFACE

INTERFACE HOST
MODULE PROCEDURE HOST_MODEL
END INTERFACE

     
INTERFACE CRC64
MODULE PROCEDURE CRC64_MODEL
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_MODEL
END INTERFACE

INTERFACE SIZE
MODULE PROCEDURE SIZE_MODEL
END INTERFACE


CONTAINS

SUBROUTINE SAVE_MODEL (KLUN, YD)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD
IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (MODEL), INTENT (IN), TARGET :: YD
LOGICAL :: LYRCST
WRITE (KLUN) YD%LINEAR_MODEL
CALL SAVE_MODEL_GENERAL_CONF_TYPE (KLUN, YD%YRML_GCONF)
CALL SAVE_MODEL_ATMOS_OCEAN_COUPLING_TYPE (KLUN, YD%YRML_AOC)
CALL SAVE_MODEL_DYNAMICS_TYPE (KLUN, YD%YRML_DYN)
CALL SAVE_MODEL_PHYSICS_GENERAL_TYPE (KLUN, YD%YRML_PHY_G)
CALL SAVE_MODEL_PHYSICS_ECMWF_TYPE (KLUN, YD%YRML_PHY_EC)
CALL SAVE_MODEL_PHYSICS_SIMPLINEAR_TYPE (KLUN, YD%YRML_PHY_SLIN)
CALL SAVE_MODEL_PHYSICS_AEROSOL_TYPE (KLUN, YD%YRML_PHY_AER)
CALL SAVE_MODEL_PHYSICS_RADIATION_TYPE (KLUN, YD%YRML_PHY_RAD)
CALL SAVE_MODEL_PHYSICS_STOCHAST_TYPE (KLUN, YD%YRML_PHY_STOCH)
CALL SAVE_MODEL_PHYSICS_MF_TYPE (KLUN, YD%YRML_PHY_MF)
CALL SAVE_MODEL_CHEM_TYPE (KLUN, YD%YRML_CHEM)
CALL SAVE_MODEL_DIAGNOSTICS_TYPE (KLUN, YD%YRML_DIAG)
CALL SAVE_TEWCOU (KLUN, YD%YREWCOU)
LYRCST = ASSOCIATED (YD%YRCST)
WRITE (KLUN) LYRCST
IF (LYRCST) THEN
  CALL SAVE_TCST (KLUN, YD%YRCST)
ENDIF
CALL SAVE_TELBC_MODEL (KLUN, YD%YRML_LBC)
WRITE (KLUN) YD%MOBJECT_ID
WRITE (KLUN) YD%COBJECT_ID
END SUBROUTINE

SUBROUTINE LOAD_MODEL (KLUN, YD)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (MODEL), INTENT (OUT), TARGET :: YD
LOGICAL :: LYRCST
READ (KLUN) YD%LINEAR_MODEL
CALL LOAD_MODEL_GENERAL_CONF_TYPE (KLUN, YD%YRML_GCONF)
CALL LOAD_MODEL_ATMOS_OCEAN_COUPLING_TYPE (KLUN, YD%YRML_AOC)
CALL LOAD_MODEL_DYNAMICS_TYPE (KLUN, YD%YRML_DYN)
CALL LOAD_MODEL_PHYSICS_GENERAL_TYPE (KLUN, YD%YRML_PHY_G)
CALL LOAD_MODEL_PHYSICS_ECMWF_TYPE (KLUN, YD%YRML_PHY_EC)
CALL LOAD_MODEL_PHYSICS_SIMPLINEAR_TYPE (KLUN, YD%YRML_PHY_SLIN)
CALL LOAD_MODEL_PHYSICS_AEROSOL_TYPE (KLUN, YD%YRML_PHY_AER)
CALL LOAD_MODEL_PHYSICS_RADIATION_TYPE (KLUN, YD%YRML_PHY_RAD)
CALL LOAD_MODEL_PHYSICS_STOCHAST_TYPE (KLUN, YD%YRML_PHY_STOCH)
CALL LOAD_MODEL_PHYSICS_MF_TYPE (KLUN, YD%YRML_PHY_MF)
CALL LOAD_MODEL_CHEM_TYPE (KLUN, YD%YRML_CHEM)
CALL LOAD_MODEL_DIAGNOSTICS_TYPE (KLUN, YD%YRML_DIAG)
CALL LOAD_TEWCOU (KLUN, YD%YREWCOU)
READ (KLUN) LYRCST
IF (LYRCST) THEN
  ALLOCATE (YD%YRCST)
  CALL LOAD_TCST (KLUN, YD%YRCST)
ELSE
  NULLIFY (YD%YRCST)
ENDIF
CALL LOAD_TELBC_MODEL (KLUN, YD%YRML_LBC)
READ (KLUN) YD%MOBJECT_ID
READ (KLUN) YD%COBJECT_ID
END SUBROUTINE


SUBROUTINE COPY_MODEL (YD, LDCREATED, LDFIELDAPI)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD
IMPLICIT NONE
TYPE (MODEL), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI
LOGICAL :: LYRCST

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$ACC ENTER DATA CREATE (YD)
  !$ACC UPDATE DEVICE (YD)
ENDIF

CALL COPY_MODEL_GENERAL_CONF_TYPE (YD%YRML_GCONF, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_ATMOS_OCEAN_COUPLING_TYPE (YD%YRML_AOC, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_DYNAMICS_TYPE (YD%YRML_DYN, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_GENERAL_TYPE (YD%YRML_PHY_G, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_ECMWF_TYPE (YD%YRML_PHY_EC, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_SIMPLINEAR_TYPE (YD%YRML_PHY_SLIN, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_AEROSOL_TYPE (YD%YRML_PHY_AER, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_RADIATION_TYPE (YD%YRML_PHY_RAD, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_STOCHAST_TYPE (YD%YRML_PHY_STOCH, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_PHYSICS_MF_TYPE (YD%YRML_PHY_MF, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_CHEM_TYPE (YD%YRML_CHEM, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_MODEL_DIAGNOSTICS_TYPE (YD%YRML_DIAG, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_TEWCOU (YD%YREWCOU, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

LYRCST = ASSOCIATED (YD%YRCST)
IF (LYRCST) THEN
  !$ACC ENTER DATA CREATE (YD%YRCST)
  !$ACC UPDATE DEVICE (YD%YRCST)
  CALL COPY_TCST (YD%YRCST, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)
  !$ACC ENTER DATA ATTACH (YD%YRCST)
ENDIF

CALL COPY_TELBC_MODEL (YD%YRML_LBC, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)



END SUBROUTINE

SUBROUTINE HOST_MODEL (YD)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD

IMPLICIT NONE
TYPE (MODEL), TARGET :: YD
LOGICAL :: LYRCST

CALL HOST_MODEL_GENERAL_CONF_TYPE (YD%YRML_GCONF)

CALL HOST_MODEL_ATMOS_OCEAN_COUPLING_TYPE (YD%YRML_AOC)

CALL HOST_MODEL_DYNAMICS_TYPE (YD%YRML_DYN)

CALL HOST_MODEL_PHYSICS_GENERAL_TYPE (YD%YRML_PHY_G)

CALL HOST_MODEL_PHYSICS_ECMWF_TYPE (YD%YRML_PHY_EC)

CALL HOST_MODEL_PHYSICS_SIMPLINEAR_TYPE (YD%YRML_PHY_SLIN)

CALL HOST_MODEL_PHYSICS_AEROSOL_TYPE (YD%YRML_PHY_AER)

CALL HOST_MODEL_PHYSICS_RADIATION_TYPE (YD%YRML_PHY_RAD)

CALL HOST_MODEL_PHYSICS_STOCHAST_TYPE (YD%YRML_PHY_STOCH)

CALL HOST_MODEL_PHYSICS_MF_TYPE (YD%YRML_PHY_MF)

CALL HOST_MODEL_CHEM_TYPE (YD%YRML_CHEM)

CALL HOST_MODEL_DIAGNOSTICS_TYPE (YD%YRML_DIAG)

CALL HOST_TEWCOU (YD%YREWCOU)

LYRCST = ASSOCIATED (YD%YRCST)
IF (LYRCST) THEN
  CALL HOST_TCST (YD%YRCST)
ENDIF

CALL HOST_TELBC_MODEL (YD%YRML_LBC)



END SUBROUTINE

     

SUBROUTINE CRC64_MODEL (YD, KLUN, CDPATH)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD
USE CRC64_INTRINSIC, ONLY : FCRC64 => CRC64

IMPLICIT NONE
TYPE (MODEL), TARGET :: YD
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND
LOGICAL :: LYRCST
WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LINEAR_MODEL), CDPATH//'%LINEAR_MODEL'

CLIND = ''
CALL CRC64_MODEL_GENERAL_CONF_TYPE (YD%YRML_GCONF, KLUN, CDPATH//'%YRML_GCONF'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_ATMOS_OCEAN_COUPLING_TYPE (YD%YRML_AOC, KLUN, CDPATH//'%YRML_AOC'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_DYNAMICS_TYPE (YD%YRML_DYN, KLUN, CDPATH//'%YRML_DYN'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_GENERAL_TYPE (YD%YRML_PHY_G, KLUN, CDPATH//'%YRML_PHY_G'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_ECMWF_TYPE (YD%YRML_PHY_EC, KLUN, CDPATH//'%YRML_PHY_EC'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_SIMPLINEAR_TYPE (YD%YRML_PHY_SLIN, KLUN, CDPATH//'%YRML_PHY_SLIN'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_AEROSOL_TYPE (YD%YRML_PHY_AER, KLUN, CDPATH//'%YRML_PHY_AER'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_RADIATION_TYPE (YD%YRML_PHY_RAD, KLUN, CDPATH//'%YRML_PHY_RAD'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_STOCHAST_TYPE (YD%YRML_PHY_STOCH, KLUN, CDPATH//'%YRML_PHY_STOCH'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_PHYSICS_MF_TYPE (YD%YRML_PHY_MF, KLUN, CDPATH//'%YRML_PHY_MF'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_CHEM_TYPE (YD%YRML_CHEM, KLUN, CDPATH//'%YRML_CHEM'//TRIM(CLIND))

CLIND = ''
CALL CRC64_MODEL_DIAGNOSTICS_TYPE (YD%YRML_DIAG, KLUN, CDPATH//'%YRML_DIAG'//TRIM(CLIND))

CLIND = ''
CALL CRC64_TEWCOU (YD%YREWCOU, KLUN, CDPATH//'%YREWCOU'//TRIM(CLIND))

LYRCST = ASSOCIATED (YD%YRCST)
IF (LYRCST) THEN
  CLIND = ''
  CALL CRC64_TCST (YD%YRCST, KLUN, CDPATH//'%YRCST'//TRIM(CLIND))
ENDIF

CLIND = ''
CALL CRC64_TELBC_MODEL (YD%YRML_LBC, KLUN, CDPATH//'%YRML_LBC'//TRIM(CLIND))

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%MOBJECT_ID), CDPATH//'%MOBJECT_ID'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%COBJECT_ID), CDPATH//'%COBJECT_ID'

END SUBROUTINE

SUBROUTINE WIPE_MODEL (YD, LDDELETED, LDFIELDAPI)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD
IMPLICIT NONE
TYPE (MODEL), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI
LOGICAL :: LYRCST

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF

CALL WIPE_MODEL_GENERAL_CONF_TYPE (YD%YRML_GCONF, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_ATMOS_OCEAN_COUPLING_TYPE (YD%YRML_AOC, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_DYNAMICS_TYPE (YD%YRML_DYN, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_GENERAL_TYPE (YD%YRML_PHY_G, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_ECMWF_TYPE (YD%YRML_PHY_EC, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_SIMPLINEAR_TYPE (YD%YRML_PHY_SLIN, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_AEROSOL_TYPE (YD%YRML_PHY_AER, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_RADIATION_TYPE (YD%YRML_PHY_RAD, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_STOCHAST_TYPE (YD%YRML_PHY_STOCH, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_PHYSICS_MF_TYPE (YD%YRML_PHY_MF, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_CHEM_TYPE (YD%YRML_CHEM, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_MODEL_DIAGNOSTICS_TYPE (YD%YRML_DIAG, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_TEWCOU (YD%YREWCOU, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

LYRCST = ASSOCIATED (YD%YRCST)
IF (LYRCST) THEN
  !$ACC EXIT DATA DETACH (YD%YRCST)
  CALL WIPE_TCST (YD%YRCST, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)
  !$ACC EXIT DATA DETACH (YD%YRCST)
ENDIF

CALL WIPE_TELBC_MODEL (YD%YRML_LBC, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)



LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$ACC EXIT DATA DELETE (YD)
ENDIF
END SUBROUTINE

INTEGER*8 FUNCTION SIZE_MODEL (YD, CDPATH, LDPRINT) RESULT (KSIZE)
USE UTIL_MODEL_ATMOS_OCEAN_COUPLING_TYPE_MOD
USE UTIL_MODEL_CHEM_TYPE_MOD
USE UTIL_MODEL_DIAGNOSTICS_TYPE_MOD
USE UTIL_MODEL_DYNAMICS_TYPE_MOD
USE UTIL_MODEL_GENERAL_CONF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_AEROSOL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_ECMWF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_GENERAL_TYPE_MOD
USE UTIL_MODEL_PHYSICS_MF_TYPE_MOD
USE UTIL_MODEL_PHYSICS_RADIATION_TYPE_MOD
USE UTIL_MODEL_PHYSICS_SIMPLINEAR_TYPE_MOD
USE UTIL_MODEL_PHYSICS_STOCHAST_TYPE_MOD
USE UTIL_TCST_MOD
USE UTIL_TELBC_MODEL_MOD
USE UTIL_TEWCOU_MOD
IMPLICIT NONE
TYPE (MODEL),     INTENT (IN), TARGET :: YD
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH
LOGICAL :: LYRCST

LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
ISIZE = KIND (YD%LINEAR_MODEL)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LINEAR_MODEL'
ENDIF
KSIZE = KSIZE + ISIZE
JSIZE = 0
ISIZE = SIZE_MODEL_GENERAL_CONF_TYPE (YD%YRML_GCONF, CLPATH//'%YRML_GCONF', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_GCONF'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_ATMOS_OCEAN_COUPLING_TYPE (YD%YRML_AOC, CLPATH//'%YRML_AOC', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_AOC'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_DYNAMICS_TYPE (YD%YRML_DYN, CLPATH//'%YRML_DYN', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_DYN'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_GENERAL_TYPE (YD%YRML_PHY_G, CLPATH//'%YRML_PHY_G', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_G'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_ECMWF_TYPE (YD%YRML_PHY_EC, CLPATH//'%YRML_PHY_EC', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_EC'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_SIMPLINEAR_TYPE (YD%YRML_PHY_SLIN, CLPATH//'%YRML_PHY_SLIN', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_SLIN'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_AEROSOL_TYPE (YD%YRML_PHY_AER, CLPATH//'%YRML_PHY_AER', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_AER'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_RADIATION_TYPE (YD%YRML_PHY_RAD, CLPATH//'%YRML_PHY_RAD', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_RAD'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_STOCHAST_TYPE (YD%YRML_PHY_STOCH, CLPATH//'%YRML_PHY_STOCH', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_STOCH'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_PHYSICS_MF_TYPE (YD%YRML_PHY_MF, CLPATH//'%YRML_PHY_MF', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_PHY_MF'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_CHEM_TYPE (YD%YRML_CHEM, CLPATH//'%YRML_CHEM', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_CHEM'
ENDIF
JSIZE = 0
ISIZE = SIZE_MODEL_DIAGNOSTICS_TYPE (YD%YRML_DIAG, CLPATH//'%YRML_DIAG', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_DIAG'
ENDIF
JSIZE = 0
ISIZE = SIZE_TEWCOU (YD%YREWCOU, CLPATH//'%YREWCOU', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YREWCOU'
ENDIF
LYRCST = ASSOCIATED (YD%YRCST)
IF (LYRCST) THEN
  JSIZE = 0
  ISIZE = SIZE_TCST (YD%YRCST, CLPATH//'%YRCST', .FALSE.)
  JSIZE = JSIZE + ISIZE
  KSIZE = KSIZE + ISIZE
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
    WRITE (*, *) TRIM (CLPATH)//'%YRCST'
  ENDIF
ENDIF
JSIZE = 0
ISIZE = SIZE_TELBC_MODEL (YD%YRML_LBC, CLPATH//'%YRML_LBC', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%YRML_LBC'
ENDIF
ISIZE = KIND (YD%MOBJECT_ID)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%MOBJECT_ID'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%COBJECT_ID) * LEN (YD%COBJECT_ID)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%COBJECT_ID'
ENDIF
KSIZE = KSIZE + ISIZE
END FUNCTION

END MODULE
