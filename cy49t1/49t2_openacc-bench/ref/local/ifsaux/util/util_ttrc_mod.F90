MODULE UTIL_TTRC_MOD

USE YOMTRC, ONLY : TTRC

INTERFACE SAVE
MODULE PROCEDURE SAVE_TTRC
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_TTRC
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_TTRC
END INTERFACE

INTERFACE HOST
MODULE PROCEDURE HOST_TTRC
END INTERFACE

     
INTERFACE CRC64
MODULE PROCEDURE CRC64_TTRC
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_TTRC
END INTERFACE

INTERFACE SIZE
MODULE PROCEDURE SIZE_TTRC
END INTERFACE


CONTAINS

SUBROUTINE SAVE_TTRC (KLUN, YD)

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TTRC), INTENT (IN), TARGET :: YD
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2
LGRSURF = ALLOCATED (YD%GRSURF)
WRITE (KLUN) LGRSURF
IF (LGRSURF) THEN
  WRITE (KLUN) LBOUND (YD%GRSURF)
  WRITE (KLUN) UBOUND (YD%GRSURF)
  WRITE (KLUN) YD%GRSURF
ENDIF
LGDEOTI = ALLOCATED (YD%GDEOTI)
WRITE (KLUN) LGDEOTI
IF (LGDEOTI) THEN
  WRITE (KLUN) LBOUND (YD%GDEOTI)
  WRITE (KLUN) UBOUND (YD%GDEOTI)
  WRITE (KLUN) YD%GDEOTI
ENDIF
LGDEOTI2 = ALLOCATED (YD%GDEOTI2)
WRITE (KLUN) LGDEOTI2
IF (LGDEOTI2) THEN
  WRITE (KLUN) LBOUND (YD%GDEOTI2)
  WRITE (KLUN) UBOUND (YD%GDEOTI2)
  WRITE (KLUN) YD%GDEOTI2
ENDIF
LGUEOTI = ALLOCATED (YD%GUEOTI)
WRITE (KLUN) LGUEOTI
IF (LGUEOTI) THEN
  WRITE (KLUN) LBOUND (YD%GUEOTI)
  WRITE (KLUN) UBOUND (YD%GUEOTI)
  WRITE (KLUN) YD%GUEOTI
ENDIF
LGUEOTI2 = ALLOCATED (YD%GUEOTI2)
WRITE (KLUN) LGUEOTI2
IF (LGUEOTI2) THEN
  WRITE (KLUN) LBOUND (YD%GUEOTI2)
  WRITE (KLUN) UBOUND (YD%GUEOTI2)
  WRITE (KLUN) YD%GUEOTI2
ENDIF
LGEOLT = ALLOCATED (YD%GEOLT)
WRITE (KLUN) LGEOLT
IF (LGEOLT) THEN
  WRITE (KLUN) LBOUND (YD%GEOLT)
  WRITE (KLUN) UBOUND (YD%GEOLT)
  WRITE (KLUN) YD%GEOLT
ENDIF
LGEOXT = ALLOCATED (YD%GEOXT)
WRITE (KLUN) LGEOXT
IF (LGEOXT) THEN
  WRITE (KLUN) LBOUND (YD%GEOXT)
  WRITE (KLUN) UBOUND (YD%GEOXT)
  WRITE (KLUN) YD%GEOXT
ENDIF
LGRPROX = ALLOCATED (YD%GRPROX)
WRITE (KLUN) LGRPROX
IF (LGRPROX) THEN
  WRITE (KLUN) LBOUND (YD%GRPROX)
  WRITE (KLUN) UBOUND (YD%GRPROX)
  WRITE (KLUN) YD%GRPROX
ENDIF
LGMIXP = ALLOCATED (YD%GMIXP)
WRITE (KLUN) LGMIXP
IF (LGMIXP) THEN
  WRITE (KLUN) LBOUND (YD%GMIXP)
  WRITE (KLUN) UBOUND (YD%GMIXP)
  WRITE (KLUN) YD%GMIXP
ENDIF
LGFLUXC = ALLOCATED (YD%GFLUXC)
WRITE (KLUN) LGFLUXC
IF (LGFLUXC) THEN
  WRITE (KLUN) LBOUND (YD%GFLUXC)
  WRITE (KLUN) UBOUND (YD%GFLUXC)
  WRITE (KLUN) YD%GFLUXC
ENDIF
LGDEOSI = ALLOCATED (YD%GDEOSI)
WRITE (KLUN) LGDEOSI
IF (LGDEOSI) THEN
  WRITE (KLUN) LBOUND (YD%GDEOSI)
  WRITE (KLUN) UBOUND (YD%GDEOSI)
  WRITE (KLUN) YD%GDEOSI
ENDIF
LGUEOSI = ALLOCATED (YD%GUEOSI)
WRITE (KLUN) LGUEOSI
IF (LGUEOSI) THEN
  WRITE (KLUN) LBOUND (YD%GUEOSI)
  WRITE (KLUN) UBOUND (YD%GUEOSI)
  WRITE (KLUN) YD%GUEOSI
ENDIF
LGMU0 = ALLOCATED (YD%GMU0)
WRITE (KLUN) LGMU0
IF (LGMU0) THEN
  WRITE (KLUN) LBOUND (YD%GMU0)
  WRITE (KLUN) UBOUND (YD%GMU0)
  WRITE (KLUN) YD%GMU0
ENDIF
LGMU0_MIN = ALLOCATED (YD%GMU0_MIN)
WRITE (KLUN) LGMU0_MIN
IF (LGMU0_MIN) THEN
  WRITE (KLUN) LBOUND (YD%GMU0_MIN)
  WRITE (KLUN) UBOUND (YD%GMU0_MIN)
  WRITE (KLUN) YD%GMU0_MIN
ENDIF
LGMU0_MAX = ALLOCATED (YD%GMU0_MAX)
WRITE (KLUN) LGMU0_MAX
IF (LGMU0_MAX) THEN
  WRITE (KLUN) LBOUND (YD%GMU0_MAX)
  WRITE (KLUN) UBOUND (YD%GMU0_MAX)
  WRITE (KLUN) YD%GMU0_MAX
ENDIF
END SUBROUTINE

SUBROUTINE LOAD_TTRC (KLUN, YD)
USE PARKIND1, ONLY : JPRD

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TTRC), INTENT (OUT), TARGET :: YD
INTEGER :: IL2(2), IU2(2), IL3(3), IU3(3), IL4(4), IU4(4)
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2
REAL(KIND=JPRD), ALLOCATABLE :: ZTMP2 (:,:)
REAL(KIND=JPRD), ALLOCATABLE :: ZTMP3 (:,:,:)
REAL(KIND=JPRD), ALLOCATABLE :: ZTMP4 (:,:,:,:)
READ (KLUN) LGRSURF
IF (LGRSURF) THEN
  READ (KLUN) IL2
  READ (KLUN) IU2
  ALLOCATE (YD%GRSURF (IL2(1):IU2(1), IL2(2):IU2(2)))
  ALLOCATE (ZTMP2(LBOUND(YD%GRSURF,1):UBOUND(YD%GRSURF,1), LBOUND(YD%GRSURF,2):UBOUND(YD%GRSURF,2)))
  READ (KLUN) ZTMP2
  YD%GRSURF = ZTMP2
  DEALLOCATE (ZTMP2)
ENDIF
READ (KLUN) LGDEOTI
IF (LGDEOTI) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GDEOTI (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GDEOTI,1):UBOUND(YD%GDEOTI,1), LBOUND(YD%GDEOTI,2):UBOUND(YD%GDEOTI,2), LBOUND(YD%GDEOTI,3):UBOUND(YD%GDEOTI,3)))
  READ (KLUN) ZTMP3
  YD%GDEOTI = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGDEOTI2
IF (LGDEOTI2) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GDEOTI2 (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GDEOTI2,1):UBOUND(YD%GDEOTI2,1), LBOUND(YD%GDEOTI2,2):UBOUND(YD%GDEOTI2,2), LBOUND(YD%GDEOTI2,3):UBOUND(YD%GDEOTI2,3)))
  READ (KLUN) ZTMP3
  YD%GDEOTI2 = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGUEOTI
IF (LGUEOTI) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GUEOTI (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GUEOTI,1):UBOUND(YD%GUEOTI,1), LBOUND(YD%GUEOTI,2):UBOUND(YD%GUEOTI,2), LBOUND(YD%GUEOTI,3):UBOUND(YD%GUEOTI,3)))
  READ (KLUN) ZTMP3
  YD%GUEOTI = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGUEOTI2
IF (LGUEOTI2) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GUEOTI2 (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GUEOTI2,1):UBOUND(YD%GUEOTI2,1), LBOUND(YD%GUEOTI2,2):UBOUND(YD%GUEOTI2,2), LBOUND(YD%GUEOTI2,3):UBOUND(YD%GUEOTI2,3)))
  READ (KLUN) ZTMP3
  YD%GUEOTI2 = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGEOLT
IF (LGEOLT) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GEOLT (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GEOLT,1):UBOUND(YD%GEOLT,1), LBOUND(YD%GEOLT,2):UBOUND(YD%GEOLT,2), LBOUND(YD%GEOLT,3):UBOUND(YD%GEOLT,3)))
  READ (KLUN) ZTMP3
  YD%GEOLT = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGEOXT
IF (LGEOXT) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GEOXT (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GEOXT,1):UBOUND(YD%GEOXT,1), LBOUND(YD%GEOXT,2):UBOUND(YD%GEOXT,2), LBOUND(YD%GEOXT,3):UBOUND(YD%GEOXT,3)))
  READ (KLUN) ZTMP3
  YD%GEOXT = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGRPROX
IF (LGRPROX) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GRPROX (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GRPROX,1):UBOUND(YD%GRPROX,1), LBOUND(YD%GRPROX,2):UBOUND(YD%GRPROX,2), LBOUND(YD%GRPROX,3):UBOUND(YD%GRPROX,3)))
  READ (KLUN) ZTMP3
  YD%GRPROX = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGMIXP
IF (LGMIXP) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GMIXP (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GMIXP,1):UBOUND(YD%GMIXP,1), LBOUND(YD%GMIXP,2):UBOUND(YD%GMIXP,2), LBOUND(YD%GMIXP,3):UBOUND(YD%GMIXP,3)))
  READ (KLUN) ZTMP3
  YD%GMIXP = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGFLUXC
IF (LGFLUXC) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GFLUXC (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GFLUXC,1):UBOUND(YD%GFLUXC,1), LBOUND(YD%GFLUXC,2):UBOUND(YD%GFLUXC,2), LBOUND(YD%GFLUXC,3):UBOUND(YD%GFLUXC,3)))
  READ (KLUN) ZTMP3
  YD%GFLUXC = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGDEOSI
IF (LGDEOSI) THEN
  READ (KLUN) IL4
  READ (KLUN) IU4
  ALLOCATE (YD%GDEOSI (IL4(1):IU4(1), IL4(2):IU4(2), IL4(3):IU4(3), IL4(4):IU4(4)))
  ALLOCATE (ZTMP4(LBOUND(YD%GDEOSI,1):UBOUND(YD%GDEOSI,1), LBOUND(YD%GDEOSI,2):UBOUND(YD%GDEOSI,2), LBOUND(YD%GDEOSI,3):UBOUND(YD%GDEOSI,3), LBOUND(YD%GDEOSI,4):UBOUND(YD%GDEOSI,4)))
  READ (KLUN) ZTMP4
  YD%GDEOSI = ZTMP4
  DEALLOCATE (ZTMP4)
ENDIF
READ (KLUN) LGUEOSI
IF (LGUEOSI) THEN
  READ (KLUN) IL4
  READ (KLUN) IU4
  ALLOCATE (YD%GUEOSI (IL4(1):IU4(1), IL4(2):IU4(2), IL4(3):IU4(3), IL4(4):IU4(4)))
  ALLOCATE (ZTMP4(LBOUND(YD%GUEOSI,1):UBOUND(YD%GUEOSI,1), LBOUND(YD%GUEOSI,2):UBOUND(YD%GUEOSI,2), LBOUND(YD%GUEOSI,3):UBOUND(YD%GUEOSI,3), LBOUND(YD%GUEOSI,4):UBOUND(YD%GUEOSI,4)))
  READ (KLUN) ZTMP4
  YD%GUEOSI = ZTMP4
  DEALLOCATE (ZTMP4)
ENDIF
READ (KLUN) LGMU0
IF (LGMU0) THEN
  READ (KLUN) IL3
  READ (KLUN) IU3
  ALLOCATE (YD%GMU0 (IL3(1):IU3(1), IL3(2):IU3(2), IL3(3):IU3(3)))
  ALLOCATE (ZTMP3(LBOUND(YD%GMU0,1):UBOUND(YD%GMU0,1), LBOUND(YD%GMU0,2):UBOUND(YD%GMU0,2), LBOUND(YD%GMU0,3):UBOUND(YD%GMU0,3)))
  READ (KLUN) ZTMP3
  YD%GMU0 = ZTMP3
  DEALLOCATE (ZTMP3)
ENDIF
READ (KLUN) LGMU0_MIN
IF (LGMU0_MIN) THEN
  READ (KLUN) IL2
  READ (KLUN) IU2
  ALLOCATE (YD%GMU0_MIN (IL2(1):IU2(1), IL2(2):IU2(2)))
  ALLOCATE (ZTMP2(LBOUND(YD%GMU0_MIN,1):UBOUND(YD%GMU0_MIN,1), LBOUND(YD%GMU0_MIN,2):UBOUND(YD%GMU0_MIN,2)))
  READ (KLUN) ZTMP2
  YD%GMU0_MIN = ZTMP2
  DEALLOCATE (ZTMP2)
ENDIF
READ (KLUN) LGMU0_MAX
IF (LGMU0_MAX) THEN
  READ (KLUN) IL2
  READ (KLUN) IU2
  ALLOCATE (YD%GMU0_MAX (IL2(1):IU2(1), IL2(2):IU2(2)))
  ALLOCATE (ZTMP2(LBOUND(YD%GMU0_MAX,1):UBOUND(YD%GMU0_MAX,1), LBOUND(YD%GMU0_MAX,2):UBOUND(YD%GMU0_MAX,2)))
  READ (KLUN) ZTMP2
  YD%GMU0_MAX = ZTMP2
  DEALLOCATE (ZTMP2)
ENDIF
END SUBROUTINE


SUBROUTINE COPY_TTRC (YD, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TTRC), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$ACC ENTER DATA CREATE (YD)
  !$ACC UPDATE DEVICE (YD)
ENDIF
LGRSURF = ALLOCATED (YD%GRSURF)
IF (LGRSURF) THEN
  !$ACC ENTER DATA CREATE (YD%GRSURF)
  !$ACC UPDATE DEVICE (YD%GRSURF)
  !$ACC ENTER DATA ATTACH (YD%GRSURF)
ENDIF

LGDEOTI = ALLOCATED (YD%GDEOTI)
IF (LGDEOTI) THEN
  !$ACC ENTER DATA CREATE (YD%GDEOTI)
  !$ACC UPDATE DEVICE (YD%GDEOTI)
  !$ACC ENTER DATA ATTACH (YD%GDEOTI)
ENDIF

LGDEOTI2 = ALLOCATED (YD%GDEOTI2)
IF (LGDEOTI2) THEN
  !$ACC ENTER DATA CREATE (YD%GDEOTI2)
  !$ACC UPDATE DEVICE (YD%GDEOTI2)
  !$ACC ENTER DATA ATTACH (YD%GDEOTI2)
ENDIF

LGUEOTI = ALLOCATED (YD%GUEOTI)
IF (LGUEOTI) THEN
  !$ACC ENTER DATA CREATE (YD%GUEOTI)
  !$ACC UPDATE DEVICE (YD%GUEOTI)
  !$ACC ENTER DATA ATTACH (YD%GUEOTI)
ENDIF

LGUEOTI2 = ALLOCATED (YD%GUEOTI2)
IF (LGUEOTI2) THEN
  !$ACC ENTER DATA CREATE (YD%GUEOTI2)
  !$ACC UPDATE DEVICE (YD%GUEOTI2)
  !$ACC ENTER DATA ATTACH (YD%GUEOTI2)
ENDIF

LGEOLT = ALLOCATED (YD%GEOLT)
IF (LGEOLT) THEN
  !$ACC ENTER DATA CREATE (YD%GEOLT)
  !$ACC UPDATE DEVICE (YD%GEOLT)
  !$ACC ENTER DATA ATTACH (YD%GEOLT)
ENDIF

LGEOXT = ALLOCATED (YD%GEOXT)
IF (LGEOXT) THEN
  !$ACC ENTER DATA CREATE (YD%GEOXT)
  !$ACC UPDATE DEVICE (YD%GEOXT)
  !$ACC ENTER DATA ATTACH (YD%GEOXT)
ENDIF

LGRPROX = ALLOCATED (YD%GRPROX)
IF (LGRPROX) THEN
  !$ACC ENTER DATA CREATE (YD%GRPROX)
  !$ACC UPDATE DEVICE (YD%GRPROX)
  !$ACC ENTER DATA ATTACH (YD%GRPROX)
ENDIF

LGMIXP = ALLOCATED (YD%GMIXP)
IF (LGMIXP) THEN
  !$ACC ENTER DATA CREATE (YD%GMIXP)
  !$ACC UPDATE DEVICE (YD%GMIXP)
  !$ACC ENTER DATA ATTACH (YD%GMIXP)
ENDIF

LGFLUXC = ALLOCATED (YD%GFLUXC)
IF (LGFLUXC) THEN
  !$ACC ENTER DATA CREATE (YD%GFLUXC)
  !$ACC UPDATE DEVICE (YD%GFLUXC)
  !$ACC ENTER DATA ATTACH (YD%GFLUXC)
ENDIF

LGDEOSI = ALLOCATED (YD%GDEOSI)
IF (LGDEOSI) THEN
  !$ACC ENTER DATA CREATE (YD%GDEOSI)
  !$ACC UPDATE DEVICE (YD%GDEOSI)
  !$ACC ENTER DATA ATTACH (YD%GDEOSI)
ENDIF

LGUEOSI = ALLOCATED (YD%GUEOSI)
IF (LGUEOSI) THEN
  !$ACC ENTER DATA CREATE (YD%GUEOSI)
  !$ACC UPDATE DEVICE (YD%GUEOSI)
  !$ACC ENTER DATA ATTACH (YD%GUEOSI)
ENDIF

LGMU0 = ALLOCATED (YD%GMU0)
IF (LGMU0) THEN
  !$ACC ENTER DATA CREATE (YD%GMU0)
  !$ACC UPDATE DEVICE (YD%GMU0)
  !$ACC ENTER DATA ATTACH (YD%GMU0)
ENDIF

LGMU0_MIN = ALLOCATED (YD%GMU0_MIN)
IF (LGMU0_MIN) THEN
  !$ACC ENTER DATA CREATE (YD%GMU0_MIN)
  !$ACC UPDATE DEVICE (YD%GMU0_MIN)
  !$ACC ENTER DATA ATTACH (YD%GMU0_MIN)
ENDIF

LGMU0_MAX = ALLOCATED (YD%GMU0_MAX)
IF (LGMU0_MAX) THEN
  !$ACC ENTER DATA CREATE (YD%GMU0_MAX)
  !$ACC UPDATE DEVICE (YD%GMU0_MAX)
  !$ACC ENTER DATA ATTACH (YD%GMU0_MAX)
ENDIF

END SUBROUTINE

SUBROUTINE HOST_TTRC (YD)

IMPLICIT NONE
TYPE (TTRC), TARGET :: YD
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2















END SUBROUTINE

     

SUBROUTINE CRC64_TTRC (YD, KLUN, CDPATH)
USE CRC64_INTRINSIC, ONLY : FCRC64 => CRC64

IMPLICIT NONE
TYPE (TTRC), TARGET :: YD
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2
WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GRSURF), CDPATH//'%GRSURF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GDEOTI), CDPATH//'%GDEOTI'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GDEOTI2), CDPATH//'%GDEOTI2'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GUEOTI), CDPATH//'%GUEOTI'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GUEOTI2), CDPATH//'%GUEOTI2'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GEOLT), CDPATH//'%GEOLT'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GEOXT), CDPATH//'%GEOXT'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GRPROX), CDPATH//'%GRPROX'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GMIXP), CDPATH//'%GMIXP'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GFLUXC), CDPATH//'%GFLUXC'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GDEOSI), CDPATH//'%GDEOSI'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GUEOSI), CDPATH//'%GUEOSI'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GMU0), CDPATH//'%GMU0'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GMU0_MIN), CDPATH//'%GMU0_MIN'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%GMU0_MAX), CDPATH//'%GMU0_MAX'

END SUBROUTINE

SUBROUTINE WIPE_TTRC (YD, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TTRC), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LGRSURF = ALLOCATED (YD%GRSURF)
IF (LGRSURF) THEN
  !$ACC EXIT DATA DETACH (YD%GRSURF)
  !$ACC EXIT DATA DETACH (YD%GRSURF)
ENDIF

LGDEOTI = ALLOCATED (YD%GDEOTI)
IF (LGDEOTI) THEN
  !$ACC EXIT DATA DETACH (YD%GDEOTI)
  !$ACC EXIT DATA DETACH (YD%GDEOTI)
ENDIF

LGDEOTI2 = ALLOCATED (YD%GDEOTI2)
IF (LGDEOTI2) THEN
  !$ACC EXIT DATA DETACH (YD%GDEOTI2)
  !$ACC EXIT DATA DETACH (YD%GDEOTI2)
ENDIF

LGUEOTI = ALLOCATED (YD%GUEOTI)
IF (LGUEOTI) THEN
  !$ACC EXIT DATA DETACH (YD%GUEOTI)
  !$ACC EXIT DATA DETACH (YD%GUEOTI)
ENDIF

LGUEOTI2 = ALLOCATED (YD%GUEOTI2)
IF (LGUEOTI2) THEN
  !$ACC EXIT DATA DETACH (YD%GUEOTI2)
  !$ACC EXIT DATA DETACH (YD%GUEOTI2)
ENDIF

LGEOLT = ALLOCATED (YD%GEOLT)
IF (LGEOLT) THEN
  !$ACC EXIT DATA DETACH (YD%GEOLT)
  !$ACC EXIT DATA DETACH (YD%GEOLT)
ENDIF

LGEOXT = ALLOCATED (YD%GEOXT)
IF (LGEOXT) THEN
  !$ACC EXIT DATA DETACH (YD%GEOXT)
  !$ACC EXIT DATA DETACH (YD%GEOXT)
ENDIF

LGRPROX = ALLOCATED (YD%GRPROX)
IF (LGRPROX) THEN
  !$ACC EXIT DATA DETACH (YD%GRPROX)
  !$ACC EXIT DATA DETACH (YD%GRPROX)
ENDIF

LGMIXP = ALLOCATED (YD%GMIXP)
IF (LGMIXP) THEN
  !$ACC EXIT DATA DETACH (YD%GMIXP)
  !$ACC EXIT DATA DETACH (YD%GMIXP)
ENDIF

LGFLUXC = ALLOCATED (YD%GFLUXC)
IF (LGFLUXC) THEN
  !$ACC EXIT DATA DETACH (YD%GFLUXC)
  !$ACC EXIT DATA DETACH (YD%GFLUXC)
ENDIF

LGDEOSI = ALLOCATED (YD%GDEOSI)
IF (LGDEOSI) THEN
  !$ACC EXIT DATA DETACH (YD%GDEOSI)
  !$ACC EXIT DATA DETACH (YD%GDEOSI)
ENDIF

LGUEOSI = ALLOCATED (YD%GUEOSI)
IF (LGUEOSI) THEN
  !$ACC EXIT DATA DETACH (YD%GUEOSI)
  !$ACC EXIT DATA DETACH (YD%GUEOSI)
ENDIF

LGMU0 = ALLOCATED (YD%GMU0)
IF (LGMU0) THEN
  !$ACC EXIT DATA DETACH (YD%GMU0)
  !$ACC EXIT DATA DETACH (YD%GMU0)
ENDIF

LGMU0_MIN = ALLOCATED (YD%GMU0_MIN)
IF (LGMU0_MIN) THEN
  !$ACC EXIT DATA DETACH (YD%GMU0_MIN)
  !$ACC EXIT DATA DETACH (YD%GMU0_MIN)
ENDIF

LGMU0_MAX = ALLOCATED (YD%GMU0_MAX)
IF (LGMU0_MAX) THEN
  !$ACC EXIT DATA DETACH (YD%GMU0_MAX)
  !$ACC EXIT DATA DETACH (YD%GMU0_MAX)
ENDIF

LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$ACC EXIT DATA DELETE (YD)
ENDIF
END SUBROUTINE

INTEGER*8 FUNCTION SIZE_TTRC (YD, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
TYPE (TTRC),     INTENT (IN), TARGET :: YD
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH
LOGICAL :: LGDEOSI, LGDEOTI, LGDEOTI2, LGEOLT, LGEOXT, LGFLUXC, LGMIXP, LGMU0, LGMU0_MAX, LGMU0_MIN
LOGICAL :: LGRPROX, LGRSURF, LGUEOSI, LGUEOTI, LGUEOTI2

LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
LGRSURF = ALLOCATED (YD%GRSURF)
IF (LGRSURF) THEN
  ISIZE = KIND (YD%GRSURF) * SIZE (YD%GRSURF)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GRSURF'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGDEOTI = ALLOCATED (YD%GDEOTI)
IF (LGDEOTI) THEN
  ISIZE = KIND (YD%GDEOTI) * SIZE (YD%GDEOTI)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GDEOTI'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGDEOTI2 = ALLOCATED (YD%GDEOTI2)
IF (LGDEOTI2) THEN
  ISIZE = KIND (YD%GDEOTI2) * SIZE (YD%GDEOTI2)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GDEOTI2'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGUEOTI = ALLOCATED (YD%GUEOTI)
IF (LGUEOTI) THEN
  ISIZE = KIND (YD%GUEOTI) * SIZE (YD%GUEOTI)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GUEOTI'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGUEOTI2 = ALLOCATED (YD%GUEOTI2)
IF (LGUEOTI2) THEN
  ISIZE = KIND (YD%GUEOTI2) * SIZE (YD%GUEOTI2)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GUEOTI2'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGEOLT = ALLOCATED (YD%GEOLT)
IF (LGEOLT) THEN
  ISIZE = KIND (YD%GEOLT) * SIZE (YD%GEOLT)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GEOLT'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGEOXT = ALLOCATED (YD%GEOXT)
IF (LGEOXT) THEN
  ISIZE = KIND (YD%GEOXT) * SIZE (YD%GEOXT)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GEOXT'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGRPROX = ALLOCATED (YD%GRPROX)
IF (LGRPROX) THEN
  ISIZE = KIND (YD%GRPROX) * SIZE (YD%GRPROX)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GRPROX'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGMIXP = ALLOCATED (YD%GMIXP)
IF (LGMIXP) THEN
  ISIZE = KIND (YD%GMIXP) * SIZE (YD%GMIXP)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GMIXP'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGFLUXC = ALLOCATED (YD%GFLUXC)
IF (LGFLUXC) THEN
  ISIZE = KIND (YD%GFLUXC) * SIZE (YD%GFLUXC)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GFLUXC'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGDEOSI = ALLOCATED (YD%GDEOSI)
IF (LGDEOSI) THEN
  ISIZE = KIND (YD%GDEOSI) * SIZE (YD%GDEOSI)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GDEOSI'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGUEOSI = ALLOCATED (YD%GUEOSI)
IF (LGUEOSI) THEN
  ISIZE = KIND (YD%GUEOSI) * SIZE (YD%GUEOSI)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GUEOSI'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGMU0 = ALLOCATED (YD%GMU0)
IF (LGMU0) THEN
  ISIZE = KIND (YD%GMU0) * SIZE (YD%GMU0)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GMU0'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGMU0_MIN = ALLOCATED (YD%GMU0_MIN)
IF (LGMU0_MIN) THEN
  ISIZE = KIND (YD%GMU0_MIN) * SIZE (YD%GMU0_MIN)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GMU0_MIN'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LGMU0_MAX = ALLOCATED (YD%GMU0_MAX)
IF (LGMU0_MAX) THEN
  ISIZE = KIND (YD%GMU0_MAX) * SIZE (YD%GMU0_MAX)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%GMU0_MAX'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
END FUNCTION

END MODULE
