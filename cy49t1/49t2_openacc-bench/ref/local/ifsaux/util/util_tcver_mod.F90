MODULE UTIL_TCVER_MOD

USE YOMCVER, ONLY : TCVER

INTERFACE SAVE
MODULE PROCEDURE SAVE_TCVER
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_TCVER
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_TCVER
END INTERFACE

INTERFACE HOST
MODULE PROCEDURE HOST_TCVER
END INTERFACE

     
INTERFACE CRC64
MODULE PROCEDURE CRC64_TCVER
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_TCVER
END INTERFACE

INTERFACE SIZE
MODULE PROCEDURE SIZE_TCVER
END INTERFACE


CONTAINS

SUBROUTINE SAVE_TCVER (KLUN, YD)

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TCVER), INTENT (IN), TARGET :: YD

WRITE (KLUN) YD%LAPRXPK
WRITE (KLUN) YD%NDLNPR
WRITE (KLUN) YD%RHYDR0
WRITE (KLUN) YD%LREGETA
WRITE (KLUN) YD%LVFE_REGETA
WRITE (KLUN) YD%NVFE_TYPE
WRITE (KLUN) YD%NVFE_ORDER
WRITE (KLUN) YD%NVFE_INTERNALS
WRITE (KLUN) YD%LVERTFE
WRITE (KLUN) YD%LVFE_LAPL_BC
WRITE (KLUN) YD%LVFE_GW
WRITE (KLUN) YD%LVFE_GW_HALF
WRITE (KLUN) YD%LVFE_GWMPA
WRITE (KLUN) YD%LVFE_CHEB
WRITE (KLUN) YD%LVFE_ECMWF
WRITE (KLUN) YD%LVFE_NOBC
WRITE (KLUN) YD%LVFE_VERBOSE
WRITE (KLUN) YD%LVFE_NORMALIZE
WRITE (KLUN) YD%LDYN_ANALYSIS_STABILITY
WRITE (KLUN) YD%LPERCENTILS
WRITE (KLUN) YD%LVFE_COMPATIBLE
WRITE (KLUN) YD%LVFE_FD_MIX
WRITE (KLUN) YD%LVFE_SILAPL
WRITE (KLUN) YD%LVFD_COMPATIBLE
WRITE (KLUN) YD%LREFINE_NHPRE_BBC
WRITE (KLUN) YD%RVFE_ALPHA
WRITE (KLUN) YD%RVFE_BETA
WRITE (KLUN) YD%RVFE_KNOT_STRETCH
WRITE (KLUN) YD%RFAC1
WRITE (KLUN) YD%RFAC2
WRITE (KLUN) YD%CVFE_ETAH
END SUBROUTINE

SUBROUTINE LOAD_TCVER (KLUN, YD)
USE PARKIND1, ONLY : JPRD

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TCVER), INTENT (OUT), TARGET :: YD
REAL(KIND=JPRD) :: ZTMP0
READ (KLUN) YD%LAPRXPK
READ (KLUN) YD%NDLNPR
READ (KLUN) ZTMP0
YD%RHYDR0 = ZTMP0
READ (KLUN) YD%LREGETA
READ (KLUN) YD%LVFE_REGETA
READ (KLUN) YD%NVFE_TYPE
READ (KLUN) YD%NVFE_ORDER
READ (KLUN) YD%NVFE_INTERNALS
READ (KLUN) YD%LVERTFE
READ (KLUN) YD%LVFE_LAPL_BC
READ (KLUN) YD%LVFE_GW
READ (KLUN) YD%LVFE_GW_HALF
READ (KLUN) YD%LVFE_GWMPA
READ (KLUN) YD%LVFE_CHEB
READ (KLUN) YD%LVFE_ECMWF
READ (KLUN) YD%LVFE_NOBC
READ (KLUN) YD%LVFE_VERBOSE
READ (KLUN) YD%LVFE_NORMALIZE
READ (KLUN) YD%LDYN_ANALYSIS_STABILITY
READ (KLUN) YD%LPERCENTILS
READ (KLUN) YD%LVFE_COMPATIBLE
READ (KLUN) YD%LVFE_FD_MIX
READ (KLUN) YD%LVFE_SILAPL
READ (KLUN) YD%LVFD_COMPATIBLE
READ (KLUN) YD%LREFINE_NHPRE_BBC
READ (KLUN) ZTMP0
YD%RVFE_ALPHA = ZTMP0
READ (KLUN) ZTMP0
YD%RVFE_BETA = ZTMP0
READ (KLUN) ZTMP0
YD%RVFE_KNOT_STRETCH = ZTMP0
READ (KLUN) ZTMP0
YD%RFAC1 = ZTMP0
READ (KLUN) ZTMP0
YD%RFAC2 = ZTMP0
READ (KLUN) YD%CVFE_ETAH
END SUBROUTINE


SUBROUTINE COPY_TCVER (YD, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TCVER), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$ACC ENTER DATA CREATE (YD)
  !$ACC UPDATE DEVICE (YD)
ENDIF































END SUBROUTINE

SUBROUTINE HOST_TCVER (YD)

IMPLICIT NONE
TYPE (TCVER), TARGET :: YD
































END SUBROUTINE

     

SUBROUTINE CRC64_TCVER (YD, KLUN, CDPATH)
USE CRC64_INTRINSIC, ONLY : FCRC64 => CRC64

IMPLICIT NONE
TYPE (TCVER), TARGET :: YD
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LAPRXPK), CDPATH//'%LAPRXPK'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NDLNPR), CDPATH//'%NDLNPR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RHYDR0), CDPATH//'%RHYDR0'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LREGETA), CDPATH//'%LREGETA'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_REGETA), CDPATH//'%LVFE_REGETA'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVFE_TYPE), CDPATH//'%NVFE_TYPE'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVFE_ORDER), CDPATH//'%NVFE_ORDER'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVFE_INTERNALS), CDPATH//'%NVFE_INTERNALS'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVERTFE), CDPATH//'%LVERTFE'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_LAPL_BC), CDPATH//'%LVFE_LAPL_BC'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_GW), CDPATH//'%LVFE_GW'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_GW_HALF), CDPATH//'%LVFE_GW_HALF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_GWMPA), CDPATH//'%LVFE_GWMPA'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_CHEB), CDPATH//'%LVFE_CHEB'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_ECMWF), CDPATH//'%LVFE_ECMWF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_NOBC), CDPATH//'%LVFE_NOBC'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_VERBOSE), CDPATH//'%LVFE_VERBOSE'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_NORMALIZE), CDPATH//'%LVFE_NORMALIZE'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LDYN_ANALYSIS_STABILITY), CDPATH//'%LDYN_ANALYSIS_STABILITY'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LPERCENTILS), CDPATH//'%LPERCENTILS'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_COMPATIBLE), CDPATH//'%LVFE_COMPATIBLE'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_FD_MIX), CDPATH//'%LVFE_FD_MIX'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFE_SILAPL), CDPATH//'%LVFE_SILAPL'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LVFD_COMPATIBLE), CDPATH//'%LVFD_COMPATIBLE'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LREFINE_NHPRE_BBC), CDPATH//'%LREFINE_NHPRE_BBC'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RVFE_ALPHA), CDPATH//'%RVFE_ALPHA'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RVFE_BETA), CDPATH//'%RVFE_BETA'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RVFE_KNOT_STRETCH), CDPATH//'%RVFE_KNOT_STRETCH'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RFAC1), CDPATH//'%RFAC1'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RFAC2), CDPATH//'%RFAC2'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%CVFE_ETAH), CDPATH//'%CVFE_ETAH'

END SUBROUTINE

SUBROUTINE WIPE_TCVER (YD, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TCVER), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF































LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$ACC EXIT DATA DELETE (YD)
ENDIF
END SUBROUTINE

INTEGER*8 FUNCTION SIZE_TCVER (YD, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
TYPE (TCVER),     INTENT (IN), TARGET :: YD
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH

LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
ISIZE = KIND (YD%LAPRXPK)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LAPRXPK'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NDLNPR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NDLNPR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RHYDR0)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RHYDR0'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LREGETA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LREGETA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_REGETA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_REGETA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVFE_TYPE)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVFE_TYPE'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVFE_ORDER)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVFE_ORDER'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVFE_INTERNALS)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVFE_INTERNALS'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVERTFE)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVERTFE'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_LAPL_BC)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_LAPL_BC'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_GW)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_GW'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_GW_HALF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_GW_HALF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_GWMPA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_GWMPA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_CHEB)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_CHEB'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_ECMWF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_ECMWF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_NOBC)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_NOBC'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_VERBOSE)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_VERBOSE'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_NORMALIZE)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_NORMALIZE'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LDYN_ANALYSIS_STABILITY)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LDYN_ANALYSIS_STABILITY'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LPERCENTILS)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LPERCENTILS'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_COMPATIBLE)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_COMPATIBLE'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_FD_MIX)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_FD_MIX'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFE_SILAPL)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFE_SILAPL'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LVFD_COMPATIBLE)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LVFD_COMPATIBLE'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LREFINE_NHPRE_BBC)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LREFINE_NHPRE_BBC'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RVFE_ALPHA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RVFE_ALPHA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RVFE_BETA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RVFE_BETA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RVFE_KNOT_STRETCH)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RVFE_KNOT_STRETCH'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RFAC1)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RFAC1'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RFAC2)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RFAC2'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%CVFE_ETAH) * LEN (YD%CVFE_ETAH)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%CVFE_ETAH'
ENDIF
KSIZE = KSIZE + ISIZE
END FUNCTION

END MODULE
