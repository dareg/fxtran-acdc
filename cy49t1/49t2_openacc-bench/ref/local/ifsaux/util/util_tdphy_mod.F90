MODULE UTIL_TDPHY_MOD

USE YOMDPHY, ONLY : TDPHY

INTERFACE SAVE
MODULE PROCEDURE SAVE_TDPHY
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_TDPHY
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_TDPHY
END INTERFACE

INTERFACE HOST
MODULE PROCEDURE HOST_TDPHY
END INTERFACE

     
INTERFACE CRC64
MODULE PROCEDURE CRC64_TDPHY
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_TDPHY
END INTERFACE

INTERFACE SIZE
MODULE PROCEDURE SIZE_TDPHY
END INTERFACE


CONTAINS

SUBROUTINE SAVE_TDPHY (KLUN, YD)

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TDPHY), INTENT (IN), TARGET :: YD

WRITE (KLUN) YD%NCSS
WRITE (KLUN) YD%NVXP
WRITE (KLUN) YD%NVXP2
WRITE (KLUN) YD%NCXP
WRITE (KLUN) YD%NCSI
WRITE (KLUN) YD%NCOM
WRITE (KLUN) YD%NCSNEC
WRITE (KLUN) YD%NTILES
WRITE (KLUN) YD%NVEXTR
WRITE (KLUN) YD%NVEXTRDI
WRITE (KLUN) YD%NVEXTRRAD
WRITE (KLUN) YD%NVEXTRDYN
WRITE (KLUN) YD%NVXTR2
WRITE (KLUN) YD%NVECOUT
WRITE (KLUN) YD%NCEXTR
WRITE (KLUN) YD%NVCLIS
WRITE (KLUN) YD%NTOZ1D
WRITE (KLUN) YD%NTOZ2D
WRITE (KLUN) YD%NTOZ3D
WRITE (KLUN) YD%NTSSG
WRITE (KLUN) YD%LTPROF
WRITE (KLUN) YD%LDIRCLSMOD
WRITE (KLUN) YD%LDIRSICMOD
END SUBROUTINE

SUBROUTINE LOAD_TDPHY (KLUN, YD)

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TDPHY), INTENT (OUT), TARGET :: YD

READ (KLUN) YD%NCSS
READ (KLUN) YD%NVXP
READ (KLUN) YD%NVXP2
READ (KLUN) YD%NCXP
READ (KLUN) YD%NCSI
READ (KLUN) YD%NCOM
READ (KLUN) YD%NCSNEC
READ (KLUN) YD%NTILES
READ (KLUN) YD%NVEXTR
READ (KLUN) YD%NVEXTRDI
READ (KLUN) YD%NVEXTRRAD
READ (KLUN) YD%NVEXTRDYN
READ (KLUN) YD%NVXTR2
READ (KLUN) YD%NVECOUT
READ (KLUN) YD%NCEXTR
READ (KLUN) YD%NVCLIS
READ (KLUN) YD%NTOZ1D
READ (KLUN) YD%NTOZ2D
READ (KLUN) YD%NTOZ3D
READ (KLUN) YD%NTSSG
READ (KLUN) YD%LTPROF
READ (KLUN) YD%LDIRCLSMOD
READ (KLUN) YD%LDIRSICMOD
END SUBROUTINE


SUBROUTINE COPY_TDPHY (YD, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TDPHY), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$ACC ENTER DATA CREATE (YD)
  !$ACC UPDATE DEVICE (YD)
ENDIF























END SUBROUTINE

SUBROUTINE HOST_TDPHY (YD)

IMPLICIT NONE
TYPE (TDPHY), TARGET :: YD
























END SUBROUTINE

     

SUBROUTINE CRC64_TDPHY (YD, KLUN, CDPATH)
USE CRC64_INTRINSIC, ONLY : FCRC64 => CRC64

IMPLICIT NONE
TYPE (TDPHY), TARGET :: YD
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NCSS), CDPATH//'%NCSS'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVXP), CDPATH//'%NVXP'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVXP2), CDPATH//'%NVXP2'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NCXP), CDPATH//'%NCXP'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NCSI), CDPATH//'%NCSI'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NCOM), CDPATH//'%NCOM'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NCSNEC), CDPATH//'%NCSNEC'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NTILES), CDPATH//'%NTILES'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVEXTR), CDPATH//'%NVEXTR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVEXTRDI), CDPATH//'%NVEXTRDI'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVEXTRRAD), CDPATH//'%NVEXTRRAD'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVEXTRDYN), CDPATH//'%NVEXTRDYN'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVXTR2), CDPATH//'%NVXTR2'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVECOUT), CDPATH//'%NVECOUT'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NCEXTR), CDPATH//'%NCEXTR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NVCLIS), CDPATH//'%NVCLIS'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NTOZ1D), CDPATH//'%NTOZ1D'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NTOZ2D), CDPATH//'%NTOZ2D'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NTOZ3D), CDPATH//'%NTOZ3D'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NTSSG), CDPATH//'%NTSSG'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LTPROF), CDPATH//'%LTPROF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LDIRCLSMOD), CDPATH//'%LDIRCLSMOD'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LDIRSICMOD), CDPATH//'%LDIRSICMOD'

END SUBROUTINE

SUBROUTINE WIPE_TDPHY (YD, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TDPHY), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF























LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$ACC EXIT DATA DELETE (YD)
ENDIF
END SUBROUTINE

INTEGER*8 FUNCTION SIZE_TDPHY (YD, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
TYPE (TDPHY),     INTENT (IN), TARGET :: YD
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH

LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
ISIZE = KIND (YD%NCSS)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NCSS'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVXP)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVXP'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVXP2)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVXP2'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NCXP)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NCXP'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NCSI)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NCSI'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NCOM)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NCOM'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NCSNEC)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NCSNEC'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NTILES)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NTILES'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVEXTR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVEXTR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVEXTRDI)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVEXTRDI'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVEXTRRAD)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVEXTRRAD'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVEXTRDYN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVEXTRDYN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVXTR2)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVXTR2'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVECOUT)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVECOUT'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NCEXTR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NCEXTR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NVCLIS)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NVCLIS'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NTOZ1D)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NTOZ1D'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NTOZ2D)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NTOZ2D'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NTOZ3D)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NTOZ3D'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NTSSG)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NTSSG'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LTPROF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LTPROF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LDIRCLSMOD)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LDIRCLSMOD'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LDIRSICMOD)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LDIRSICMOD'
ENDIF
KSIZE = KSIZE + ISIZE
END FUNCTION

END MODULE
