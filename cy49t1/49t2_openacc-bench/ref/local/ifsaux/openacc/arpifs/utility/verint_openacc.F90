SUBROUTINE VERINT_OPENACC (KPROMA, KST, KEND, KLEVIN, KLEVOUT&
&, PINTE, PIN, POUT, KTYPE, KCHUNK, POUTS, PINS, YDSTACK)
!$ACC ROUTINE (VERINT_OPENACC) SEQ
USE PARKIND1,ONLY:JPRD, JPIM, JPRB

USE YOMLUN,ONLY:NULERR
USE OML_MOD,ONLY:OML_IN_PARALLEL
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

INTEGER (KIND=JPIM), INTENT (IN)::KCHUNK
INTEGER (KIND=JPIM), INTENT (IN)::KTYPE
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KLEVOUT
INTEGER (KIND=JPIM), INTENT (IN)::KLEVIN
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
REAL (KIND=JPRD), INTENT (IN)::PINTE (KLEVOUT, KLEVIN)
REAL (KIND=JPRB), INTENT (IN), TARGET::PIN (KPROMA, KLEVIN)
REAL (KIND=JPRB), INTENT (OUT), TARGET::POUT (KPROMA, KLEVOUT-1)
REAL (KIND=JPRD), INTENT (IN), OPTIONAL, TARGET::POUTS (KPROMA)
REAL (KIND=JPRB), INTENT (IN), OPTIONAL::PINS (KPROMA)
TYPE(STACK), INTENT (IN) :: YDSTACK
INTEGER (KIND=JPIM)::JLEVIN
INTEGER (KIND=JPIM)::JLEVOUT
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLEN
LOGICAL, PARAMETER::LLDOUBLE=JPRB==JPRD
LOGICAL, SAVE::LLSIMPLE_DGEMM=.FALSE.
LOGICAL, PARAMETER::LLVERINT_ON_CPU=.TRUE.
CHARACTER (LEN=8), SAVE::CLENV=''
REAL (KIND=JPRD), POINTER::ZIN (KPROMA, KLEVIN)
REAL (KIND=JPRD), POINTER::ZOUT (KPROMA, KLEVOUT-1)
REAL (KIND=JPRD), TARGET::ZIN0 (KPROMA, MERGE (KLEVIN, 0,.NOT.LLDOUBLE))
REAL (KIND=JPRD), TARGET::ZOUT0 (KPROMA, MERGE (KLEVOUT-1, 0,.NOT.LLDOUBLE))
LOGICAL::LLOML_IN_PARALLEL



INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA



LLOML_IN_PARALLEL=.TRUE.


IF (LLDOUBLE) THEN
#ifndef PARKIND1_SINGLE
  assoc (ZOUT, POUT)
  assoc (ZIN, PIN)
#endif
ELSE
  assoc (ZIN, ZIN0)
  assoc (ZOUT, ZOUT0)

  DO JLEV=1, KLEVIN

    DO JROF=KST, KEND
      ZIN (JROF, JLEV)=REAL (PIN (JROF, JLEV), KIND=JPRD)
    ENDDO

  ENDDO

ENDIF


ZOUT=0._JPRD

DO JLEVIN=1, KLEVIN

  DO JLEVOUT=1, KLEVOUT-1

    DO JROF=KST, KEND
      ZOUT (JROF, JLEVOUT)=ZOUT (JROF, JLEVOUT)+PINTE (JLEVOUT, JLEVIN)*ZIN (JROF, JLEVIN)
    ENDDO

  ENDDO

ENDDO



IF (KTYPE==1) THEN

  IF (PRESENT (PINS)) THEN

    DO JLEV=1, KLEVOUT-1

      DO JROF=KST, KEND

        IF (.NOT.LLDOUBLE) THEN
          POUT (JROF, JLEV)=REAL (ZOUT (JROF, JLEV)-POUTS (JROF), JPRB)+PINS (JROF)
        ELSE
          POUT (JROF, JLEV)=ZOUT (JROF, JLEV)-POUTS (JROF)+PINS (JROF)
        ENDIF

      ENDDO

    ENDDO

  ELSE

    DO JLEV=1, KLEVOUT-1

      DO JROF=KST, KEND
        POUT (JROF, JLEV)=ZOUT (JROF, JLEV)-POUTS (JROF)
      ENDDO

    ENDDO

  ENDIF

ELSEIF (KTYPE/=0) THEN
  PRINT *, 'INVALIDKTYPEINVERINT=',KTYPE
  CALL ABOR1_ACC (' VERINT: ABOR1 CALLED')
ELSEIF (PRESENT (PINS)) THEN

  DO JLEV=1, KLEVOUT-1

    DO JROF=KST, KEND
      POUT (JROF, JLEV)=ZOUT (JROF, JLEV)+PINS (JROF)
    ENDDO

  ENDDO

ELSEIF (.NOT.LLDOUBLE) THEN

  DO JLEV=1, KLEVOUT-1

    DO JROF=KST, KEND
      POUT (JROF, JLEV)=REAL (ZOUT (JROF, JLEV), KIND=JPRB)
    ENDDO

  ENDDO

ENDIF



ENDSUBROUTINE VERINT_OPENACC
