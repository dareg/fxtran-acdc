SUBROUTINE LATTEX_TNT_OPENACC (YDGEOMETRY, YDLDDH, YDDYN, KST, KEND, KXLAG, PESGP, PESGM&
&, PXT9, PMOY1X, PXSI9, PXSI0, PXT1, PXL0, PXL9, PXLF9, PSIDDHXT1, PSIDDHXL0, YDSTACK)
!$ACC ROUTINE (LATTEX_TNT_OPENACC) SEQ
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMDYN,ONLY:TDYN
USE YOMLDDH,ONLY:TLDDH
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (TDYN), INTENT (IN)::YDDYN
TYPE (TLDDH), INTENT (IN)::YDLDDH
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KXLAG
REAL (KIND=JPRB), INTENT (IN)::PESGP
REAL (KIND=JPRB), INTENT (IN)::PESGM
REAL (KIND=JPRB), INTENT (IN)::PXT9 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PMOY1X (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PXSI9 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PXSI0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PXT1 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PXL0 (YDGEOMETRY%YRDIM%NPROMA&
&, YDGEOMETRY%YRDIMV%NFLSA:YDGEOMETRY%YRDIMV%NFLEN)
REAL (KIND=JPRB), INTENT (INOUT)::PXL9 (YDGEOMETRY%YRDIM%NPROMA&
&, YDGEOMETRY%YRDIMV%NFLSA:YDGEOMETRY%YRDIMV%NFLEN)
REAL (KIND=JPRB), INTENT (INOUT)::PXLF9 (YDGEOMETRY%YRDIM%NPROMA&
&, YDGEOMETRY%YRDIMV%NFLSA:YDGEOMETRY%YRDIMV%NFLEN)
REAL (KIND=JPRB), INTENT (INOUT)::PSIDDHXT1 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PSIDDHXL0 (YDGEOMETRY%YRDIM&
&%NPROMA, YDGEOMETRY%YRDIMV%NFLSA:YDGEOMETRY%YRDIMV%NFLEN)
TYPE(STACK), INTENT (IN) :: YDSTACK
REAL (KIND=JPRB)::ZMOYXNL 
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV

INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA







DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

  DO JROF=KST, KEND
    ZMOYXNL =PMOY1X (JLON, JLEV)+PXSI0 (JLON, JLEV)
  ENDDO


  IF (KXLAG==2) THEN

    IF (YDDYN%NSPLTHOI/=0) THEN

      DO JROF=KST, KEND
        PXT1 (JLON, JLEV)=PXT1 (JLON, JLEV)+PESGP*ZMOYXNL -PESGP*PXSI0 (JLON, JLEV)
        PXL9 (JLON, JLEV)=PXL9 (JLON, JLEV)+PXT9 (JLON, JLEV)
        PXLF9 (JLON, JLEV)=PXLF9 (JLON, JLEV)+PESGM*ZMOYXNL -PESGM*PXSI9 (JLON, JLEV)
      ENDDO

    ELSE

      DO JROF=KST, KEND
        PXT1 (JLON, JLEV)=PXT1 (JLON, JLEV)+PESGP*ZMOYXNL -PESGP*PXSI0 (JLON, JLEV)
        PXL9 (JLON, JLEV)=PXL9 (JLON, JLEV)+PXT9 (JLON, JLEV)+PESGM*ZMOYXNL -PESGM*PXSI9 (JLON, JLEV)
      ENDDO

    ENDIF

  ELSEIF (KXLAG>=3) THEN

    DO JROF=KST, KEND
      PXL0 (JLON, JLEV)=PXL0 (JLON, JLEV)+PESGM*ZMOYXNL -PESGM*PXSI9 (JLON, JLEV)
      PXT1 (JLON, JLEV)=PXT1 (JLON, JLEV)+PESGP*ZMOYXNL -PESGP*PXSI0 (JLON, JLEV)
      PXL9 (JLON, JLEV)=PXL9 (JLON, JLEV)+PXT9 (JLON, JLEV)
    ENDDO

  ENDIF


  DO JROF=KST, KEND
    PXSI0 (JLON, JLEV)=PESGP*PXSI0 (JLON, JLEV)
  ENDDO

ENDDO


IF (YDLDDH%LRSIDDH) THEN

  IF (KXLAG>=3) THEN

    DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

      DO JROF=KST, KEND
        PSIDDHXL0 (JLON, JLEV)=PSIDDHXL0 (JLON, JLEV)+PESGM*PXSI0 (JLON, JLEV)-PESGM*PXSI9 (JLON, JLEV)
      ENDDO

    ENDDO

  ENDIF


  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JROF=KST, KEND
      PSIDDHXT1 (JLON, JLEV)=PSIDDHXT1 (JLON, JLEV)+PESGP*PXSI0 (JLON, JLEV)
    ENDDO

  ENDDO

ENDIF





ENDSUBROUTINE LATTEX_TNT_OPENACC
