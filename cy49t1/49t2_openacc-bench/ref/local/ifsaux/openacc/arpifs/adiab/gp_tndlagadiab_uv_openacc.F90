
SUBROUTINE GP_TNDLAGADIAB_UV_OPENACC (LDRPLANE, YDGEOMETRY, YDEPHY, YDDYN, KST, KEND, PRCORI&
&, PGNORDL, PGNORDM, PSGRTL, PSGRTM, PU, PV, PTNDU, PTNDV, PTNDU_NOC, PTNDV_NOC, YDSTACK)
!$ACC ROUTINE (GP_TNDLAGADIAB_UV_OPENACC) SEQ

USE PARKIND1,ONLY:JPIM, JPRB
USE GEOMETRY_MOD,ONLY:GEOMETRY

USE YOMDYN,ONLY:TDYN
USE YOEPHY,ONLY:TEPHY
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

LOGICAL, INTENT (IN)::LDRPLANE
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (TEPHY), INTENT (IN)::YDEPHY
TYPE (TDYN), INTENT (IN)::YDDYN
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KST
REAL (KIND=JPRB), INTENT (IN)::PRCORI (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PGNORDL (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PGNORDM (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PSGRTL (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PSGRTM (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PU (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PV (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDU (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDV (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDU_NOC (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDV_NOC (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
TYPE(STACK), INTENT (IN) :: YDSTACK

INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JROF
REAL (KIND=JPRB)::ZGNORDL2 
REAL (KIND=JPRB)::ZGNORDLM 
REAL (KIND=JPRB)::ZGNORDM2 
INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA







IF (YDEPHY%LEGWWMS.OR..NOT.YDDYN%LRFRIC) THEN

  DO JROF=KST, KEND
    PTNDU_NOC (JLON, 1:YDGEOMETRY%YRDIMV%NFLEVG)=-PSGRTL (JLON, 1:YDGEOMETRY%YRDIMV%NFLEVG)
    PTNDV_NOC (JLON, 1:YDGEOMETRY%YRDIMV%NFLEVG)=-PSGRTM (JLON, 1:YDGEOMETRY%YRDIMV%NFLEVG)
  ENDDO

ELSEIF (YDDYN%LRFRICISOTR) THEN

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JROF=KST, KEND
      PTNDU_NOC (JLON, JLEV)=-YDDYN%RKRF(JLEV)*PU (JLON, JLEV)-PSGRTL (JLON, JLEV)
      PTNDV_NOC (JLON, JLEV)=-YDDYN%RKRF(JLEV)*PV (JLON, JLEV)-PSGRTM (JLON, JLEV)
    ENDDO

  ENDDO

ELSEIF (.NOT.LDRPLANE.AND.YDGEOMETRY%YRGEM%NSTTYP==1) THEN

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JROF=KST, KEND
      PTNDU_NOC (JLON, JLEV)=-YDDYN%RKRF(JLEV)*PU (JLON, JLEV)-PSGRTL (JLON, JLEV)
      PTNDV_NOC (JLON, JLEV)=-PSGRTM (JLON, JLEV)
    ENDDO

  ENDDO

ELSE

  DO JROF=KST, KEND
    ZGNORDLM =PGNORDM (JLON)*PGNORDL (JLON)
    ZGNORDL2 =PGNORDL (JLON)**2
    ZGNORDM2 =PGNORDM (JLON)**2
  ENDDO


  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JROF=KST, KEND
      PTNDU_NOC (JLON, JLEV)=YDDYN%RKRF(JLEV)*(ZGNORDLM *PV (JLON&
      &, JLEV)-ZGNORDM2 *PU (JLON, JLEV))-PSGRTL (JLON, JLEV)
      PTNDV_NOC (JLON, JLEV)=YDDYN%RKRF(JLEV)*(ZGNORDLM *PU (JLON&
      &, JLEV)-ZGNORDL2 *PV (JLON, JLEV))-PSGRTM (JLON, JLEV)
    ENDDO

  ENDDO

ENDIF


DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

  DO JROF=KST, KEND
    PTNDU (JLON, JLEV)=PTNDU_NOC (JLON, JLEV)+PRCORI (JLON)*PV (JLON, JLEV)
    PTNDV (JLON, JLEV)=PTNDV_NOC (JLON, JLEV)-PRCORI (JLON)*PU (JLON, JLEV)
  ENDDO

ENDDO





ENDSUBROUTINE GP_TNDLAGADIAB_UV_OPENACC
