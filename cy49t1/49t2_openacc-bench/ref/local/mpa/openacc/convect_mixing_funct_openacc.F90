
SUBROUTINE CONVECT_MIXING_FUNCT_OPENACC (D, PMIXC, KMF, PER, PDR, YDSTACK)
!$ACC ROUTINE (CONVECT_MIXING_FUNCT_OPENACC) SEQ

USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PMIXC(D%NIT)
INTEGER, INTENT (IN)::KMF
REAL, INTENT (OUT)::PER(D%NIT)
REAL, INTENT (OUT)::PDR(D%NIT)
TYPE(STACK), INTENT (IN) :: YDSTACK
REAL, PARAMETER::ZSIGMA=0.166666667
REAL, PARAMETER::ZFE=4.931813949
REAL, PARAMETER::ZP=0.33267
REAL, PARAMETER::ZSQRTP=2.506628
REAL, PARAMETER::ZA2=-0.1201676
REAL, PARAMETER::ZA1=0.4361836
REAL, PARAMETER::ZT1=0.500498
REAL, PARAMETER::ZA3=0.9372980
REAL, PARAMETER::ZE45=0.01111
REAL::ZW2(D%NIT)
REAL::ZW1(D%NIT)
REAL::ZY(D%NIT)
REAL::ZX(D%NIT)
REAL::ZW11
INTEGER::JI

INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA



IF (KMF==1) THEN

  DO JI=D%NIB, D%NIE
    ZX (JI)=6.*PMIXC (JI)-3.
    ZW1 (JI)=1./(1.+ZP*ABS (ZX (JI)))
    ZY (JI)=EXP (-0.5*ZX (JI)*ZX (JI))
    ZW2 (JI)=ZA1*ZW1 (JI)+ZA2*ZW1 (JI)*ZW1 (JI)+ZA3*ZW1 (JI)*ZW1 (JI)*ZW1 (JI)
    ZW11=ZA1*ZT1+ZA2*ZT1*ZT1+ZA3*ZT1*ZT1*ZT1
  ENDDO

ENDIF


DO JI=D%NIB, D%NIE

  IF (KMF==1.AND.ZX (JI)>=0.) THEN
    PER (JI)=ZSIGMA*(0.5*(ZSQRTP-ZE45*ZW11-ZY (JI)*ZW2 (JI))+ZSIGMA&
    &*(ZE45-ZY (JI)))-0.5*ZE45*PMIXC (JI)*PMIXC (JI)
    PDR (JI)=ZSIGMA*(0.5*(ZY (JI)*ZW2 (JI)-ZE45*ZW11)+ZSIGMA*(ZE45&
    &-ZY (JI)))-ZE45*(0.5+0.5*PMIXC (JI)*PMIXC (JI)-PMIXC (JI))
  ENDIF

ENDDO


DO JI=D%NIB, D%NIE

  IF (KMF==1.AND.ZX (JI)<0.) THEN
    PER (JI)=ZSIGMA*(0.5*(ZY (JI)*ZW2 (JI)-ZE45*ZW11)+ZSIGMA&
    &*(ZE45-ZY (JI)))-0.5*ZE45*PMIXC (JI)*PMIXC (JI)
    PDR (JI)=ZSIGMA*(0.5*(ZSQRTP-ZE45*ZW11-ZY (JI)*ZW2 (JI))+ZSIGMA*(ZE45&
    &-ZY (JI)))-ZE45*(0.5+0.5*PMIXC (JI)*PMIXC (JI)-PMIXC (JI))
  ENDIF

ENDDO


DO JI=D%NIB, D%NIE
  PER (JI)=PER (JI)*ZFE
  PDR (JI)=PDR (JI)*ZFE
ENDDO



ENDSUBROUTINE CONVECT_MIXING_FUNCT_OPENACC
