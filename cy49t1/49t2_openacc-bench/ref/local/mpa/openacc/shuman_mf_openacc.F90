
MODULE MODI_SHUMAN_MF_OPENACC


IMPLICIT NONE

INTERFACE
  SUBROUTINE DZF_MF_OPENACC (D, PA, PDZF, YDSTACK)
  !$ACC ROUTINE (DZF_MF_OPENACC) SEQ
  USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
  USE STACK_MOD
  USE ABOR1_ACC_MOD
  
  IMPLICIT NONE
  
  TYPE (DIMPHYEX_T), INTENT (IN)::D
  REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
  REAL, INTENT (OUT)::PDZF(D%NIJT, D%NKT)
  TYPE(STACK), INTENT (IN) :: YDSTACK
  
  ENDSUBROUTINE DZF_MF_OPENACC
  
  SUBROUTINE DZM_MF_OPENACC (D, PA, PDZM, YDSTACK)
  !$ACC ROUTINE (DZM_MF_OPENACC) SEQ
  USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
  USE STACK_MOD
  USE ABOR1_ACC_MOD
  
  IMPLICIT NONE
  
  TYPE (DIMPHYEX_T), INTENT (IN)::D
  REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
  REAL, INTENT (OUT)::PDZM(D%NIJT, D%NKT)
  TYPE(STACK), INTENT (IN) :: YDSTACK
  
  ENDSUBROUTINE DZM_MF_OPENACC
  
  SUBROUTINE MZF_MF_OPENACC (D, PA, PMZF, YDSTACK)
  !$ACC ROUTINE (MZF_MF_OPENACC) SEQ
  USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
  USE STACK_MOD
  USE ABOR1_ACC_MOD
  
  IMPLICIT NONE
  
  TYPE (DIMPHYEX_T), INTENT (IN)::D
  REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
  REAL, INTENT (OUT)::PMZF(D%NIJT, D%NKT)
  TYPE(STACK), INTENT (IN) :: YDSTACK
  
  ENDSUBROUTINE MZF_MF_OPENACC
  
  SUBROUTINE MZM_MF_OPENACC (D, PA, PMZM, YDSTACK)
  !$ACC ROUTINE (MZM_MF_OPENACC) SEQ
  USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
  USE STACK_MOD
  USE ABOR1_ACC_MOD
  
  IMPLICIT NONE
  
  TYPE (DIMPHYEX_T), INTENT (IN)::D
  REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
  REAL, INTENT (OUT)::PMZM(D%NIJT, D%NKT)
  TYPE(STACK), INTENT (IN) :: YDSTACK
  
  ENDSUBROUTINE MZM_MF_OPENACC
  
  SUBROUTINE GZ_M_W_MF_OPENACC (D, PY, PDZZ, PGZ_M_W, YDSTACK)
  !$ACC ROUTINE (GZ_M_W_MF_OPENACC) SEQ
  USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
  USE STACK_MOD
  USE ABOR1_ACC_MOD
  
  IMPLICIT NONE
  
  TYPE (DIMPHYEX_T), INTENT (IN)::D
  REAL, INTENT (IN)::PDZZ(D%NIJT, D%NKT)
  REAL, INTENT (IN)::PY(D%NIJT, D%NKT)
  REAL, INTENT (OUT)::PGZ_M_W(D%NIJT, D%NKT)
  TYPE(STACK), INTENT (IN) :: YDSTACK
  
  ENDSUBROUTINE GZ_M_W_MF_OPENACC
  
ENDINTERFACE

ENDMODULE MODI_SHUMAN_MF_OPENACC

SUBROUTINE MZF_MF_OPENACC (D, PA, PMZF, YDSTACK)
!$ACC ROUTINE (MZF_MF_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PMZF(D%NIJT, D%NKT)
TYPE(STACK), INTENT (IN) :: YDSTACK
INTEGER::JIJ
INTEGER::JK
INTEGER::IIJE
INTEGER::IIJB
INTEGER::IKT
INTEGER::IKU
INTEGER::IKA
INTEGER::IKL
INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA


IIJE=D%NIJE
IIJB=D%NIJB
IKA=D%NKA
IKU=D%NKU
IKT=D%NKT
IKL=D%NKL

DO JK=2, IKT-1

  DO JIJ=IIJB, IIJE
    PMZF (JIJ, JK)=0.5*(PA (JIJ, JK)+PA (JIJ, JK+IKL))
  ENDDO

ENDDO


DO JIJ=IIJB, IIJE
  PMZF (JIJ, IKA)=0.5*(PA (JIJ, IKA)+PA (JIJ, IKA+IKL))
  PMZF (JIJ, IKU)=PA (JIJ, IKU)
ENDDO


ENDSUBROUTINE MZF_MF_OPENACC

SUBROUTINE MZM_MF_OPENACC (D, PA, PMZM, YDSTACK)
!$ACC ROUTINE (MZM_MF_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PMZM(D%NIJT, D%NKT)
TYPE(STACK), INTENT (IN) :: YDSTACK
INTEGER::JIJ
INTEGER::JK
INTEGER::IIJE
INTEGER::IIJB
INTEGER::IKL
INTEGER::IKT
INTEGER::IKU
INTEGER::IKA
INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA


IIJE=D%NIJE
IIJB=D%NIJB
IKA=D%NKA
IKU=D%NKU
IKT=D%NKT
IKL=D%NKL

DO JK=2, IKT-1

  DO JIJ=IIJB, IIJE
    PMZM (JIJ, JK)=0.5*(PA (JIJ, JK)+PA (JIJ, JK-IKL))
  ENDDO

ENDDO


DO JIJ=IIJB, IIJE
  PMZM (JIJ, IKA)=PA (JIJ, IKA)
  PMZM (JIJ, IKU)=0.5*(PA (JIJ, IKU)+PA (JIJ, IKU-IKL))
ENDDO


ENDSUBROUTINE MZM_MF_OPENACC

SUBROUTINE DZF_MF_OPENACC (D, PA, PDZF, YDSTACK)
!$ACC ROUTINE (DZF_MF_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PDZF(D%NIJT, D%NKT)
TYPE(STACK), INTENT (IN) :: YDSTACK
INTEGER::JIJ
INTEGER::JK
INTEGER::IIJE
INTEGER::IIJB
INTEGER::IKL
INTEGER::IKT
INTEGER::IKU
INTEGER::IKA
INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA


IIJE=D%NIJE
IIJB=D%NIJB
IKA=D%NKA
IKU=D%NKU
IKT=D%NKT
IKL=D%NKL

DO JK=2, IKT-1

  DO JIJ=IIJB, IIJE
    PDZF (JIJ, JK)=PA (JIJ, JK+IKL)-PA (JIJ, JK)
  ENDDO

ENDDO


DO JIJ=IIJB, IIJE
  PDZF (JIJ, IKA)=PA (JIJ, IKA+IKL)-PA (JIJ, IKA)
  PDZF (JIJ, IKU)=0.
ENDDO


ENDSUBROUTINE DZF_MF_OPENACC

SUBROUTINE DZM_MF_OPENACC (D, PA, PDZM, YDSTACK)
!$ACC ROUTINE (DZM_MF_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PA(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PDZM(D%NIJT, D%NKT)
TYPE(STACK), INTENT (IN) :: YDSTACK
INTEGER::JIJ
INTEGER::JK
INTEGER::IIJE
INTEGER::IIJB
INTEGER::IKL
INTEGER::IKT
INTEGER::IKU
INTEGER::IKA
INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA


IIJE=D%NIJE
IIJB=D%NIJB
IKA=D%NKA
IKU=D%NKU
IKT=D%NKT
IKL=D%NKL

DO JK=2, IKT-1

  DO JIJ=IIJB, IIJE
    PDZM (JIJ, JK)=PA (JIJ, JK)-PA (JIJ, JK-IKL)
  ENDDO

ENDDO


DO JIJ=IIJB, IIJE
  PDZM (JIJ, IKA)=0.
  PDZM (JIJ, IKU)=PA (JIJ, IKU)-PA (JIJ, IKU-IKL)
ENDDO


ENDSUBROUTINE DZM_MF_OPENACC

SUBROUTINE GZ_M_W_MF_OPENACC (D, PY, PDZZ, PGZ_M_W, YDSTACK)
!$ACC ROUTINE (GZ_M_W_MF_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PDZZ(D%NIJT, D%NKT)
REAL, INTENT (IN)::PY(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PGZ_M_W(D%NIJT, D%NKT)
TYPE(STACK), INTENT (IN) :: YDSTACK
INTEGER JIJ
INTEGER JK
INTEGER::IIJE
INTEGER::IIJB
INTEGER::IKL
INTEGER::IKT
INTEGER::IKU
INTEGER::IKA
INTEGER (KIND=JPIM) :: JLON

JLON = KIDIA


IIJE=D%NIJE
IIJB=D%NIJB
IKA=D%NKA
IKU=D%NKU
IKT=D%NKT
IKL=D%NKL

DO JK=2, IKT-1

  DO JIJ=IIJB, IIJE
    PGZ_M_W (JIJ, JK)=(PY (JIJ, JK)-PY (JIJ, JK-IKL))/PDZZ (JIJ, JK)
  ENDDO

ENDDO


DO JIJ=IIJB, IIJE
  PGZ_M_W (JIJ, IKA)=0.
  PGZ_M_W (JIJ, IKU)=(PY (JIJ, IKU)-PY (JIJ, IKU-IKL))/PDZZ (JIJ, IKU)
ENDDO


ENDSUBROUTINE GZ_M_W_MF_OPENACC
