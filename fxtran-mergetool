#!/usr/bin/perl -w

use Data::Dumper;
use Getopt::Long;
use FileHandle;
use FindBin qw ($Bin);

use lib "$Bin/fxtran-merge";

use lib '/home/marguina/perl5/lib/perl5';
use lib '/home/marguina/perl5/lib/perl5/x86_64-linux-gnu-thread-multi';

use fxtran;
use fxtran::parser;
use fxtran::xpath;

use strict;

use Fxtran::Beautifier;

my %opts = qw ();
my @opts_f = qw (simplify-associate-blocks);
my @opts_s = qw ();

&GetOptions
(
  (map { ("$_!", \$opts{$_}) } @opts_f),
  (map { ("$_=s", \$opts{$_}) } @opts_s),
);

my ($base, $local, $remote, $merged) = @ARGV;

&Fxtran::Beautifier::prepareFileForMerging ($_, %opts) 
  for ($base, $local, $remote);

&Fxtran::Beautifier::runCommand (cmd => ['kdiff3', -o => $merged, $base, $local, $remote], debug => 0);

&Fxtran::Beautifier::repackStatementsAfterMerge ($merged, %opts);

exit (0);

