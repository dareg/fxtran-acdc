SUBROUTINE VERDER_OPENACC (KPROMA, KST, KEND, KLEVIN, KLEVOUT, PDERI, PIN, POUT, YDSTACK)
!$ACC ROUTINE (VERDER_OPENACC) SEQ
USE PARKIND1,ONLY:JPRD, JPIM, JPRB

#include "stack.h"
USE STACK_MOD
USE ABOR1_ACC_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KLEVIN
INTEGER (KIND=JPIM), INTENT (IN)::KLEVOUT
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
REAL (KIND=JPRD), INTENT (IN)::PDERI (KLEVOUT, KLEVIN)
REAL (KIND=JPRB), INTENT (IN), TARGET::PIN (KPROMA, KLEVIN)
REAL (KIND=JPRB), INTENT (OUT), TARGET::POUT (KPROMA, KLEVOUT)
TYPE(STACK), INTENT (IN) :: YDSTACK
TYPE(STACK) :: YLSTACK
LOGICAL, PARAMETER::LLDOUBLE=JPRB==JPRD
LOGICAL, SAVE::LLSIMPLE_DGEMM=.FALSE.
LOGICAL, PARAMETER::LLVERINT_ON_CPU=.TRUE.
CHARACTER (LEN=8), SAVE::CLENV=''
INTEGER (KIND=JPIM)::JLEVOUT
INTEGER (KIND=JPIM)::JLEVIN
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
temp (REAL (KIND=JPRD), ZIN, (KPROMA, KLEVIN))
temp (REAL (KIND=JPRD), ZOUT, (KPROMA, KLEVOUT))
temp (REAL (KIND=JPRD), ZIN0, (KPROMA, MERGE (KLEVIN, 0,.NOT.LLDOUBLE)))
temp (REAL (KIND=JPRD), ZOUT0, (KPROMA, MERGE (KLEVOUT, 0,.NOT.LLDOUBLE)))


YLSTACK = YDSTACK



IF (KIND (ZIN0) == 8) THEN
    alloc8 (ZIN0)
ELSEIF (KIND (ZIN0) == 4) THEN
    alloc4 (ZIN0)
ELSE
    STOP 1
ENDIF


IF (KIND (ZOUT0) == 8) THEN
    alloc8 (ZOUT0)
ELSEIF (KIND (ZOUT0) == 4) THEN
    alloc4 (ZOUT0)
ELSE
    STOP 1
ENDIF


JROF = KST




IF (LLDOUBLE) THEN
#ifndef PARKIND1_SINGLE
  assoc (ZOUT, POUT)
  assoc (ZIN, PIN)
#endif
ELSE
  assoc (ZIN, ZIN0)
  assoc (ZOUT, ZOUT0)

  DO JLEV=1, KLEVIN
    
    ZIN (JROF, JLEV)=REAL (PIN (JROF, JLEV), KIND=JPRD)
  
  ENDDO

ENDIF


POUT(JROF,:)=0._JPRB

DO JLEVIN=1, KLEVIN

  DO JLEVOUT=1, KLEVOUT
    
    POUT (JROF, JLEVOUT)=POUT (JROF, JLEVOUT)+PDERI (JLEVOUT, JLEVIN)*PIN (JROF, JLEVIN)
  
  ENDDO

ENDDO



IF (.NOT.LLDOUBLE) THEN

  DO JLEV=1, KLEVOUT
    
    POUT (JROF, JLEV)=REAL (ZOUT (JROF, JLEV), JPRB)
  
  ENDDO

ENDIF


ENDSUBROUTINE VERDER_OPENACC
